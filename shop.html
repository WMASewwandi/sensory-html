<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/">

    <title>Shop - Sensory - Kids Toys Store</title>

    <!--== Favicon ==-->
    <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon" />

    <!--== Google Fonts ==-->
    <link href="https://fonts.googleapis.com/css?family=Fredoka+One:400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!--== Bootstrap CSS ==-->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <!--== Font-awesome Icons CSS ==-->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet"/>
    <!--== Pe Icon 7 Min Icons CSS ==-->
    <link href="/assets/css/pe-icon-7-stroke.min.css" rel="stylesheet"/>
    <!--== Ionicons CSS ==-->
    <link href="/assets/css/ionicons.css" rel="stylesheet"/>
    <!--== Animate CSS ==-->
    <link href="/assets/css/animate.css" rel="stylesheet"/>
    <!--== Aos CSS ==-->
    <link href="/assets/css/aos.css" rel="stylesheet"/>
    <!--== FancyBox CSS ==-->
    <link href="/assets/css/jquery.fancybox.min.css" rel="stylesheet"/>
    <!--== Slicknav CSS ==-->
    <link href="/assets/css/slicknav.css" rel="stylesheet"/>
    <!--== Swiper CSS ==-->
    <link href="/assets/css/swiper.min.css" rel="stylesheet"/>
    <!--== Slick CSS ==-->
    <link href="/assets/css/slick.css" rel="stylesheet"/>
    <!--== Rangeslider CSS ==-->
    <link href="/assets/css/rangeslider.css" rel="stylesheet"/>
    <!--== Main Style CSS ==-->
    <link href="/assets/css/style.css" rel="stylesheet" />

</head>

<body>

<!--wrapper start-->
<div class="wrapper page-shop-wrapper">

  <!--== Start Header Wrapper ==-->
  <header class="header-wrapper">
    <div class="header-top">
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-sm-5 col-md-4 col-lg-6">
            <div class="header-info-left">
            </div>
          </div>
          <div class="col-xs-12 col-sm-7 col-md-8 col-lg-6 sm-pl-0 xs-pl-15 header-top-right">
            <div class="header-info">
              <a href="tel://+94761487787"><i class="fa fa-phone"></i> +94761487787</a>
              <a href="mailto:sensorysl12@gmail.com"><i class="fa fa-envelope"></i> sensorysl12@gmail.com</a>
              <a href="login-register"><i class="fa fa-user"></i> Account</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-middle">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-12">
            <div class="header-align">
              <div class="header-align-left">
                <div class="header-logo-area">
                  <a href="/">
                    <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                    <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
                  </a>
                </div>
              </div>
              <div class="header-align-center">
                <div class="header-search-box">
                  <form action="#" method="post">
                    <div class="form-input-item">
                      <label for="search" class="sr-only">Search Everything</label>
                      <input type="text" id="search" placeholder="Search Everything">
                      <button type="submit" class="btn-src">
                        <i class="pe-7s-search"></i>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="header-align-right">
                <div class="header-action-area">
                  <div class="header-action-wishlist">
                    <button class="btn-wishlist" onclick="window.location.href='shop-wishlist'">
                      <span class="wishlist-count">0</span>
                      <i class="pe-7s-like"></i>
                    </button>
                  </div>
                  <div class="header-action-cart">
                    <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart'">
                      <span class="cart-count">0</span>
                      <i class="pe-7s-shopbag"></i>
                    </button>
                  </div>
                  <button class="btn-menu d-md-none">
                    <i class="ion-navicon"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-area header-default sticky-header">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-4 col-sm-6 col-lg-2">
            <div class="header-logo-area">
              <a href="/">
                <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
              </a>
            </div>
          </div>
          <div class="col-lg-8 sticky-md-none">
            <div class="header-navigation-area d-none d-md-block">
              <ul class="main-menu nav position-relative">
                <li><a class="ml--2" href="/">Home</a></li>
                <li><a href="about">About</a></li>
                <!-- <li class="has-submenu"><a href="/">Pages</a>
                  <ul class="submenu-nav">
                    <li><a href="shop-cart">Cart page</a></li>
                    <li><a href="shop-checkout">Checkout</a></li>
                    <li><a href="my-account">My Account</a></li>
                    <li><a href="shop-wishlist">Wishlist</a></li>
                    <li><a href="shop-compare">Compare</a></li>
                    <li><a href="login-register">Login / Register</a></li>
                    <li><a href="coming-soon">Coming soon</a></li>
                    <li><a href="page-not-found">404</a></li>
                  </ul>
                </li> -->
                <li class="active"><a href="shop">Shop</a></li>
                <li><a href="contact">Contact</a></li>
              </ul>
            </div>
          </div>
          <div class="col-8 col-sm-6 col-lg-2">
            <div class="header-action-area">
              <div class="header-action-search">
                <button class="btn-search btn-search-menu">
                  <i class="pe-7s-search"></i>
                </button>
              </div>
              <div class="header-action-login">
                <button class="btn-login" onclick="window.location.href='login-register'">
                  <i class="pe-7s-users"></i>
                </button>
              </div>
              <div class="header-action-wishlist">
                <button class="btn-wishlist" onclick="window.location.href='shop-wishlist'">
                  <span class="wishlist-count">0</span>
                  <i class="pe-7s-like"></i>
                </button>
              </div>
              <div class="header-action-cart">
                <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart'">
                  <span class="cart-count">0</span>
                  <i class="pe-7s-shopbag"></i>
                </button>
              </div>
              <button class="btn-menu d-lg-none">
                <i class="ion-navicon"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--== End Header Wrapper ==-->
  
  <main class="main-content">
    <!--== Start Page Title Area ==-->
    <section class="page-title-area">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-12 m-auto">
            <div class="page-title-content text-center">
              <h2 class="title">Product</h2>
              <!-- <div class="bread-crumbs"><a href="/"> Home </a><span class="breadcrumb-sep"> // </span><span class="active"> Product</span></div> -->
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--== End Page Title Area ==-->

    <!--== Start Shop Area Wrapper ==-->
    <div class="product-area product-grid-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-9 order-0 order-lg-1">
            <div class="shop-content">
              <div class="shop-toolbar-wrap">
                <div class="product-showing-status">
                  <p class="count-result"></p>
                </div>
                <div class="product-view-mode">
                  <nav>
                    <div class="nav nav-tabs active" id="nav-tab" role="tablist">
                      <button class="nav-link active" id="column-three-tab" data-bs-toggle="tab" data-bs-target="#column-three" type="button" role="tab" aria-controls="column-three" aria-selected="true"><i class="fa fa-th"></i></button>

                      <button class="nav-link" id="nav-list-tab" data-bs-toggle="tab" data-bs-target="#nav-list" type="button" role="tab" aria-controls="nav-list" aria-selected="false"><i class="fa fa-list"></i></button>

                      <button class="nav-link" id="column-two-tab" data-bs-toggle="tab" data-bs-target="#column-two" type="button" role="tab" aria-controls="column-two" aria-selected="true"><i class="fa fa-th-large"></i></button>
                    </div>
                  </nav>
                </div>
                <div class="product-sorting-menu product-sorting">
                  <span class="current">Sort By : <span> Default <i class="fa fa-angle-down"></i></span></span>
                  <ul>
                    <li class="active"><a href="shop" class="active">Sort by Default</a></li>
                    <li><a href="shop">Sort by Popularity</a></li>
                    <li><a href="shop">Sort by Rated</a></li>
                    <li><a href="shop">Sort by Latest</a></li>
                    <li><a href="shop">Sort by Price: <i class="lastudioicon-arrow-up"></i></a></li>
                    <li><a href="shop">Sort by Price: <i class="lastudioicon-arrow-down"></i></a></li>
                  </ul>
                </div>
              </div>
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="column-three" role="tabpanel" aria-labelledby="column-three-tab">
                  <div id="search-results-message" style="display: none; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #f379a7; border-radius: 4px;">
                    <p style="margin: 0; display: flex; justify-content: space-between; align-items: center;">
                      <span><strong>Search Results for:</strong> <span id="search-term-display"></span></span>
                      <button onclick="clearSearch()" style="background: #f379a7; color: white; border: none; padding: 5px 15px; border-radius: 3px; cursor: pointer; font-size: 14px;">Clear Search</button>
                    </p>
                  </div>
                  <div id="active-filters-display" style="display: none; margin-bottom: 15px; padding: 8px 12px; background-color: #e8f4f8; border-left: 3px solid #2196F3; border-radius: 3px;">
                    <div id="active-filters-list" style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; font-size: 13px;">
                      <span style="font-weight: 600; color: #1976D2; margin-right: 5px;">Filters:</span>
                      <!-- Active filters will be displayed here -->
                    </div>
                  </div>
                  <div class="row" id="products-container">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
                <div class="tab-pane fade" id="nav-list" role="tabpanel" aria-labelledby="nav-list-tab">
                  <div class="row" id="products-container-list">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
                <div class="tab-pane fade" id="column-two" role="tabpanel" aria-labelledby="column-two-tab">
                  <div class="row" id="products-container-two">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <div class="pagination-area mb-md-50">
                    <nav>
                      <!-- Pagination will be loaded dynamically here -->
                    </nav>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 order-1 order-lg-0">
            <div class="sidebar-area shop-sidebar-area">
              <div class="widget-item">
                <div class="widget-title">
                  <h3 class="title">Product Categories</h3>
                </div>
                <div class="widget-body">
                  <div class="widget-categories">
                    <ul id="product-categories-list">
                      <!-- Categories will be loaded dynamically here -->
                    </ul>
                  </div>
                </div>
              </div>
              <div class="widget-item">
                <div class="widget-filter">
                  <div class="widget-title">
                    <h3 class="title">Price Filter</h3>
                  </div>
                  <div class="widget-body">
                    <div class="widget-price-filter">
                      <div class="price-input-fields" style="display: flex; flex-direction: column; gap: 15px;">
                        <div class="price-input-group">
                          <label for="price-min-input" style="display: block; margin-bottom: 5px; font-weight: 500;">Min Amount (LKR)</label>
                          <input type="number" id="price-min-input" class="form-control" placeholder="Enter min amount" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="price-input-group">
                          <label for="price-max-input" style="display: block; margin-bottom: 5px; font-weight: 500;">Max Amount (LKR)</label>
                          <input type="number" id="price-max-input" class="form-control" placeholder="Enter max amount" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button type="button" id="apply-price-filter" class="btn btn-theme" style="width: 100%; padding: 10px; margin-top: 5px;">Apply Filter</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--== End Shop Area Wrapper ==-->
  </main>

  <!--== Start Footer Area Wrapper ==-->
  <footer class="footer-area default-style" >
    <div class="footer-main">
      <div class="container">
        <div class="row">
          <div class="col-12 col-lg-4">
            <div class="widget-item item-style3">
              <div class="about-widget">
                <a class="footer-logo" href="/">
                  <img src="/assets/img/logo-light.png" alt="Logo">
                </a>
                <p>
                  Sensory a brand of ANKH Trading Pvt Ltd is a curated destination for premium sensory books, toddler sensory, and early learning products, created to support holistic childhood development. We bring together safe, reliable, and thoughtfully designed sensory essentials in one place—making it easier for parents, educators, and retailers to access quality products that encourage learning through play, exploration, and imagination.
0 
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-2">
            <div class="widget-item item-style1">
              <h4 class="widget-title">Quick Links</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-1">Quick Links</h4>
              <div id="dividerId-1" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap">
                  <ul class="nav-menu nav item-hover-style">
                    <li><a href="/">- Home</a></li>
                    <li><a href="about">- About</a></li>
                    <li><a href="shop">- Shop</a></li>
                    <li><a href="contact">- Contact</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="widget-item item-style2">
              <h4 class="widget-title">Company</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-3">Company</h4>
              <div id="dividerId-3" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap item-hover-style">
                  <ul class="nav-menu nav">
                    <li><a href="terms-and-conditions">- Terms & Conditions</a></li>
                    <li><a href="privacy-policy">- Privacy Policy</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-3">
            <div class="widget-item">
              <h4 class="widget-title">Store Information.</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-4">Store Information.</h4>
              <div id="dividerId-4" class="collapse widget-collapse-body">
                <p class="widget-address">296/A/1 , Level 2 <br>New Kandy Road, <br>Kothalawala, <br>Kaduwela,
                    <br>Sri Lanka</p>
                  <ul class="widget-contact-info">
                    <li>Phone: <a href="tel://+94761487787">+94761487787</a></li>
                    <li>Email: <a href="mailto:sensorysl12@gmail.com">sensorysl12@gmail.com</a></li>
                  </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <div class="footer-bottom-content">
          <div class="row text-center">
            <div class="col-sm-12">
              <div class="widget-copyright">
                <p><i class="fa fa-copyright"></i> 2025 <span>Sensory. </span> All Rights Reserved</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-shape bg-img" data-bg-img="/assets/img/photos/footer1.png"></div>
  </footer>
  <!--== End Footer Area Wrapper ==-->

</div>
<!--wrapper end-->
  
  <!--== Scroll Top Button ==-->
  <div class="scroll-to-top"><span class="fa fa-angle-double-up"></span></div>

  <!--== Start Product Quick View ==-->
  <aside class="product-quick-view-modal">
    <div class="product-quick-view-inner">
      <div class="product-quick-view-content">
        <button type="button" class="btn-close">
          <span class="pe-7s-close"><i class="lastudioicon-e-remove"></i></span>
        </button>
        <div class="row row-gutter-0">
          <div class="col-lg-6 col-md-6 col-12">
            <div class="thumb">
              <img id="quick-view-main-image" src="/assets/img/shop/quick-view1.jpg" alt="Image">
              <div class="product-image-thumbnails" id="quick-view-thumbnails">
                <!-- Thumbnails will be loaded dynamically -->
              </div>
            </div>
          </div>
          <div class="col-lg-6 col-md-6 col-12">
            <div class="content" id="quick-view-content">
              <!-- Quick view content will be loaded dynamically -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="canvas-overlay"></div>
  </aside>
  <!--== End Product Quick View ==-->

  <!--== Start Aside Cart ==-->
  <aside class="aside-cart-wrapper offcanvas offcanvas-end" tabindex="-1" id="AsideOffcanvasCart" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h1 class="d-none" id="offcanvasRightLabel">Shopping Cart</h1>
      <button class="btn-aside-cart-close" data-bs-dismiss="offcanvas" aria-label="Close">Shopping Cart <i class="ion-ios-close-empty"></i></button>
    </div>
    <div class="offcanvas-body">
      <ul class="aside-cart-product-list" id="aside-cart-items">
        <!-- Cart items will be loaded dynamically -->
      </ul>
      <div class="aside-cart-footer">
        <div class="cart-total">
          <h4>Total: <span id="aside-cart-total">LKR 0.00</span></h4>
        </div>
        <div class="group-btn">
          <a class="btn-product" href="shop-cart">View Cart</a>
          <a class="btn-product" href="shop-checkout">Checkout</a>
        </div>
      </div>
    </div>
  </aside>
  <!--== End Aside Cart ==-->

  <!--== Start Aside Search ==-->
  <aside class="aside-search-wrapper offcanvas offcanvas-top" tabindex="-1" id="AsideOffcanvasSearch" aria-labelledby="offcanvasTopLabel">
    <div class="offcanvas-header">
      <h5 class="d-none" id="offcanvasTopLabel">Aside Search</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"><i class="pe-7s-close"></i></button>
    </div>
    <div class="offcanvas-body">
      <div class="container pt--0 pb--0">
        <div class="search-box-form-wrap">
          <div class="search-note">
            <p>Start typing and press Enter to search</p>
          </div>
          <form action="#" method="post">
            <div class="search-form position-relative">
              <label for="search-input" class="visually-hidden">Search</label>
              <input id="search-input" type="search" class="form-control" placeholder="Search entire store…">
              <button class="btn-search" type="submit"><i class="ion-ios-search-strong"></i></button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </aside>
  <!--== End Aside Search ==-->

  <!--== Start Aside Menu ==-->
  <aside class="aside-menu-wrapper offcanvas offcanvas-start" tabindex="-1" id="AsideOffcanvasMenu" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
      <h1 class="d-none" id="offcanvasExampleLabel">Aside Menu</h1>
      <button class="btn-aside-menu-close" data-bs-dismiss="offcanvas" aria-label="Close">Menu <i class="ion-ios-close-empty"></i></button>
    </div>
    <div class="offcanvas-body">
      <nav class="aside-menu-nav">
        <ul class="nav-menu">
          <li class="active"><a class="ml--2" href="/">Home</a></li>
          <li><a class="ml--2" href="shop">Shop</a></li>
          <li><a class="ml--2" href="about">About</a></li>
          <li><a class="ml--2" href="contact">Contact</a></li>
        </ul>
      </nav>
    </div>
  </aside>
  <!--== End Aside Menu ==-->

  <!-- JS Vendor, Plugins & Activation Script Files -->
  <script src="/assets/js/jquery-main.js"></script>
  <script src="/assets/js/jquery-migrate.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/popper.min.js"></script>
  <script src="/assets/js/jquery.slicknav.js"></script>
  <script src="/assets/js/swiper.min.js"></script>
  <script src="/assets/js/fancybox.min.js"></script>
  <script src="/assets/js/slick.min.js"></script>
  <script src="/assets/js/rangeSlider.js"></script>
  <script src="/assets/js/jquery-zoom.min.js"></script>
  <script src="/assets/js/isotope.pkgd.min.js"></script>
  <script src="/assets/js/aos.min.js"></script>
  <script src="/assets/js/wow.min.js"></script>
  <script src="/assets/js/parallax.min.js"></script>
  <script src="/assets/js/jquery.appear.js"></script>
  <script src="/assets/js/jquery.countdown.min.js"></script>
  <script src="/assets/js/tippy.all.min.js"></script>
  <!--=== API Config Js ===-->
  <script src="/assets/js/config.js"></script>
  <!--=== Cart & Wishlist Service Js ===-->
  <script src="/assets/js/cart-service.js"></script>
  <!--=== API Service Js ===-->
  <script src="/assets/js/api-service.js"></script>
  <!--=== Custom Js ===-->
  <script src="/assets/js/custom.js"></script>
  <style>
    /* Active Category Styling */
    #product-categories-list li a.active {
      color: #f379a7 !important;
      font-weight: 600;
    }
    
    #product-categories-list li a.active:hover {
      color: #e06896 !important;
    }
    
    /* Product Quick View Modal - Centered and Scrollable */
    .product-quick-view-modal {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      overflow: hidden !important;
      padding: 20px !important;
    }
    
    .product-quick-view-modal.active {
      overflow: hidden !important;
    }
    
    .product-quick-view-inner {
      margin: 0 !important;
      max-height: 90vh !important;
      width: 100% !important;
      max-width: 1200px !important;
      display: flex !important;
      align-items: center !important;
      transform: translate(0, 0) !important;
    }
    
    .product-quick-view-content {
      max-height: 90vh !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      display: flex !important;
      flex-direction: column !important;
    }
    
    .product-quick-view-content .row {
      margin: 0 !important;
    }
    
    .product-quick-view-content .row > div {
      padding: 0 !important;
    }
    
    .product-quick-view-content .thumb {
      max-height: 90vh !important;
      overflow: visible !important;
      display: flex !important;
      flex-direction: column !important;
    }
    
    .product-quick-view-content .thumb img {
      object-fit: contain !important;
      max-height: 60vh !important;
      width: 100% !important;
      margin-top: 20px !important;
      margin-bottom: 15px !important;
    }
    
    .product-image-thumbnails {
      display: flex !important;
      gap: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
      padding: 10px;
      flex-wrap: wrap;
      justify-content: center;
      min-height: 80px;
    }
    
    .product-image-thumbnails .thumbnail-item {
      width: 80px;
      height: 80px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 4px;
      overflow: hidden;
      transition: border-color 0.3s ease;
      margin: 5px;
    }
    
    .product-image-thumbnails .thumbnail-item:hover {
      border-color: #333;
    }
    
    .product-image-thumbnails .thumbnail-item.active {
      border-color: #007bff;
    }
    
    .product-image-thumbnails .thumbnail-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Prevent body scroll when modal is open */
    body.fix {
      overflow: hidden !important;
      position: fixed !important;
      width: 100% !important;
    }
    
    /* Toast Notification Styles */
    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 16px 24px;
      border-radius: 4px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideInRight 0.3s ease-out;
      font-size: 14px;
    }
    
    .toast-notification.success {
      background-color: #4CAF50;
    }
    
    .toast-notification.info {
      background-color: #2196F3;
    }
    
    .toast-notification .toast-icon {
      font-size: 20px;
    }
    
    .toast-notification .toast-message {
      flex: 1;
    }
    
    .toast-notification .toast-close {
      cursor: pointer;
      font-size: 18px;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    
    .toast-notification .toast-close:hover {
      opacity: 1;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    .toast-notification.hide {
      animation: slideOutRight 0.3s ease-out forwards;
    }
  </style>
  <script>
  (function($) {
    'use strict';

    // Toast notification function
    function showToast(message, type = 'success') {
      // Remove existing toasts
      $('.toast-notification').remove();
      
      const icon = type === 'success' ? '<i class="ion-checkmark-circled"></i>' : '<i class="ion-information-circled"></i>';
      const toast = $(`
        <div class="toast-notification ${type}">
          <span class="toast-icon">${icon}</span>
          <span class="toast-message">${message}</span>
          <span class="toast-close">&times;</span>
        </div>
      `);
      
      $('body').append(toast);
      
      // Auto hide after 3 seconds
      setTimeout(function() {
        toast.addClass('hide');
        setTimeout(function() {
          toast.remove();
        }, 300);
      }, 3000);
      
      // Close on click
      toast.find('.toast-close').on('click', function() {
        toast.addClass('hide');
        setTimeout(function() {
          toast.remove();
        }, 300);
      });
    }

    // Render products function
    function renderProducts(products, containerId) {
      const container = $(containerId);
      if (!container || !container.length) {
        console.warn('Container not found:', containerId);
        return;
      }
      
      container.empty();
      
      if (!products || products.length === 0) {
        container.html('<div class="col-12"><p class="text-center">No products found.</p></div>');
        return;
      }
      
      const defaultImage = 'https://www.holoimage.net/images/no-image.jpg';
      
      products.forEach((product) => {
        const productImage = (product.imageURL && product.imageURL.trim() !== '') ? product.imageURL : defaultImage;
        const productPrice = product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
        const formattedPrice = formatPrice(productPrice);
        
        // Store minimal product data for cart/wishlist (include all price fields and images)
        const productData = {
          id: product.id,
          name: product.name,
          imageURL: product.imageURL,
          imageUrl: product.imageUrl,
          images: product.images || [],
          imageUrls: product.imageUrls || [],
          sellingPrice: product.sellingPrice || 0,
          unitPrice: product.unitPrice || 0,
          description: product.description || ''
        };
        
        // Determine column class based on container - 3 products per row
        let colClass = 'col-sm-6 col-md-4 col-lg-4';
        if (containerId === '#products-container-list') {
          colClass = 'col-12 product-items-list';
        } else if (containerId === '#products-container-two') {
          colClass = 'col-sm-6';
        }
        
        let productHtml = '';
        if (containerId === '#products-container-list') {
          // List view
          productHtml = `
            <div class="${colClass}">
              <div class="product-item">
                <div class="product-thumb">
                  <img src="${productImage}" alt="${product.name}">
                  <div class="product-action">
                    <a class="action-quick-view add-to-cart-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-ios-cart"></i></a>
                    <a class="action-quick-view quick-view-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-arrow-expand"></i></a>
                    <a class="action-quick-view add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-heart"></i></a>
                  </div>
                </div>
                <div class="product-info">
                  <div class="rating">
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                  </div>
                  <h4 class="title"><a href="shop-single-product.html?id=${product.id}">${product.name}</a></h4>
                  <div class="prices">
                    <span class="price">${formattedPrice}</span>
                  </div>
                  ${product.description ? `<p>${product.description}</p>` : ''}
                </div>
              </div>
            </div>
          `;
        } else {
          // Grid view
          productHtml = `
            <div class="${colClass}">
              <div class="product-item">
                <div class="product-thumb">
                  <img src="${productImage}" alt="${product.name}">
                  <div class="product-action">
                    <a class="action-quick-view add-to-cart-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-ios-cart"></i></a>
                    <a class="action-quick-view quick-view-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-arrow-expand"></i></a>
                    <a class="action-quick-view add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-heart"></i></a>
                  </div>
                </div>
                <div class="product-info">
                  <div class="rating">
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                  </div>
                  <h4 class="title"><a href="shop-single-product.html?id=${product.id}">${product.name}</a></h4>
                  <div class="prices">
                    <span class="price">${formattedPrice}</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        
        container.append(productHtml);
      });
      
      // Attach event handlers
      attachEventHandlers();
    }
    
    // Format price
    function formatPrice(price) {
      if (!price || price === 0) return 'LKR 0.00';
      // Add thousand separators to the price
      return 'LKR ' + parseFloat(price).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    // Attach event handlers for cart and wishlist
    function attachEventHandlers() {
      $(document).off('click', '.add-to-cart-btn').on('click', '.add-to-cart-btn', function(e) {
        e.preventDefault();
        const productData = JSON.parse($(this).attr('data-product'));
        
        // Get quantity from modal input if in modal
        const quantityInput = $('.product-quick-view-modal #modal-quantity');
        if (quantityInput.length > 0) {
          const quantity = parseInt(quantityInput.val()) || 1;
          if (quantity > 0) {
            productData.quantity = quantity;
          }
        }
        
        if (window.CartService) {
          window.CartService.addToCart(productData);
          showToast('Product added to cart!', 'success');
        }
      });
      
      $(document).off('click', '.add-to-wishlist-btn').on('click', '.add-to-wishlist-btn', async function(e) {
        e.preventDefault();
        const $this = $(this);
        let productData;
        
        try {
          const productDataStr = $this.attr('data-product');
          if (!productDataStr) {
            console.error('No product data found');
            return;
          }
          productData = JSON.parse(productDataStr);
        } catch (error) {
          console.error('Error parsing product data:', error);
          return;
        }
        
        if (productData && typeof window.WishlistService !== 'undefined') {
          // Disable button to prevent multiple clicks
          $this.prop('disabled', true);
          
          try {
            const result = await window.WishlistService.addToWishlist(productData);
            
            if (result.success) {
              showToast(result.message || 'Product added to wishlist!', 'success');
            } else {
              showToast(result.message || 'Failed to add product to wishlist', 'error');
            }
          } catch (error) {
            console.error('Error adding to wishlist:', error);
            showToast('An error occurred. Please try again.', 'error');
          } finally {
            // Re-enable button
            $this.prop('disabled', false);
          }
        } else {
          showToast('Wishlist service is not available. Please refresh the page.', 'error');
        }
      });
    }
    
    // Pagination state
    let currentPage = 1;
    const itemsPerPage = 12;
    let allProducts = [];
    let filteredProducts = [];
    let totalProductsCount = 0; // Store total count from API before filtering
    let minPrice = 0;
    let maxPrice = 0;
    let priceRange = { min: 0, max: 0 };
    
    // Render pagination
    function renderPagination(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const paginationHtml = `
        <ul class="page-numbers justify-content-end">
          ${currentPage > 1 ? `
            <li>
              <a class="page-number" href="javascript:void(0)" data-page="${currentPage - 1}">
                <i class="fa fa-angle-left"></i>
              </a>
            </li>
          ` : ''}
          ${Array.from({ length: totalPages }, (_, i) => i + 1).map(page => `
            <li>
              <a class="page-number ${page === currentPage ? 'active' : ''}" href="javascript:void(0)" data-page="${page}">${page}</a>
            </li>
          `).join('')}
          ${currentPage < totalPages ? `
            <li>
              <a class="page-number next" href="javascript:void(0)" data-page="${currentPage + 1}">
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
          ` : ''}
        </ul>
      `;
      $('.pagination-area nav').html(paginationHtml);
      
      // Attach pagination click handlers
      $('.page-number').off('click').on('click', function(e) {
        e.preventDefault();
        const page = parseInt($(this).attr('data-page'));
        if (page && page !== currentPage) {
          currentPage = page;
          
          // Update URL without page reload
          const urlParams = new URLSearchParams(window.location.search);
          urlParams.set('page', page);
          const newUrl = window.location.pathname + '?' + urlParams.toString();
          window.history.pushState({ page: page }, '', newUrl);
          
          displayProducts();
        }
      });
    }
    
    // Filter products by price range
    function filterProductsByPrice(products) {
      // If price range is not set or is at default (0,0), return all products
      if (priceRange.min === 0 && priceRange.max === 0) {
        return products;
      }
      
      // If price range hasn't been properly initialized yet, return all products
      if (!priceRange.min && !priceRange.max) {
        return products;
      }
      
      // Check if price filter is at full range (default values)
      // Only skip filtering if min is 100 and max equals the calculated maxPrice
      // This allows users to set custom ranges that will actually filter
      const isDefaultMin = priceRange.min === 100;
      let isDefaultMax = false;
      
      if (maxPrice > 0) {
        // If we have a calculated maxPrice, only skip filtering if max equals it
        isDefaultMax = priceRange.max === maxPrice;
      } else {
        // If no maxPrice calculated yet, skip filtering if max is 1000 (default)
        isDefaultMax = priceRange.max === 1000;
      }
      
      // If at full/default range, show all products (no filtering)
      // Otherwise, filter by the selected price range
      if (isDefaultMin && isDefaultMax) {
        return products;
      }
      
      // Filter by price range - products must be within min and max
      return products.filter(product => {
        const productPrice = product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
        // If product has no price (0), include it
        if (productPrice === 0) {
          return true;
        }
        // Product price must be within the selected range
        return productPrice >= priceRange.min && productPrice <= priceRange.max;
      });
    }
    
    // Display products for current page
    function displayProducts() {
      // Check if we're in search mode
      const urlParams = new URLSearchParams(window.location.search);
      const searchKeyword = urlParams.get('search') || '';
      
      // Ensure allProducts is available
      if (!allProducts || allProducts.length === 0) {
        // Try to reload products if array is empty
        loadProducts();
        return;
      }
      
      // When searching, always show all search results (don't apply price filter)
      if (searchKeyword && searchKeyword.trim() !== '') {
        // When searching, show all search results without price filtering
        filteredProducts = allProducts;
      } else {
        // Only apply price filter when not searching
        filteredProducts = filterProductsByPrice(allProducts);
      }
      
      // If no filtered products, that's okay - we'll show "No products found" message
      // Don't automatically show all products if filter results are empty
      
      // Ensure currentPage is valid
      if (isNaN(currentPage) || currentPage < 1) {
        currentPage = 1;
      }
      
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const productsToShow = filteredProducts.slice(startIndex, endIndex);
      
      // Render in all three containers
      renderProducts(productsToShow, '#products-container');
      renderProducts(productsToShow, '#products-container-list');
      renderProducts(productsToShow, '#products-container-two');
      
      // Render pagination
      renderPagination(filteredProducts.length);
      
      // Update product count
      updateProductCount();
      
      // Update active filters display
      updateActiveFiltersDisplay();
    }
    
    // Update active filters display
    function updateActiveFiltersDisplay() {
      const activeFiltersContainer = $('#active-filters-display');
      const activeFiltersList = $('#active-filters-list');
      
      if (!activeFiltersContainer.length || !activeFiltersList.length) {
        return;
      }
      
      activeFiltersList.empty();
      let hasFilters = false;
      
      // Check for active category
      const urlParams = new URLSearchParams(window.location.search);
      const categoryId = urlParams.get('category');
      if (categoryId) {
        // Find category name
        const categoryName = $('#product-categories-list li a.active').text().replace(/\s*\(\d+\)$/, '') || 'Category';
        activeFiltersList.append(`
          <span class="active-filter-badge" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: #fff; border: 1px solid #2196F3; border-radius: 12px; font-size: 12px;">
            <span>Category: ${categoryName}</span>
            <button type="button" class="clear-filter-btn" data-filter="category" style="background: none; border: none; color: #2196F3; cursor: pointer; font-size: 14px; padding: 0; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; line-height: 1;">&times;</button>
          </span>
        `);
        hasFilters = true;
      }
      
      // Check for active price filter (if not at full range)
      // Only show price filter badge if it's different from default full range
      const isDefaultMin = priceRange.min === 100;
      const isDefaultMax = priceRange.max === maxPrice || (maxPrice === 0 && priceRange.max === 1000);
      const isFullRange = isDefaultMin && isDefaultMax;
      
      if (!isFullRange && priceRange.min > 0 && priceRange.max > 0 && priceRange.max > priceRange.min) {
        const minFormatted = formatPrice(priceRange.min);
        const maxFormatted = formatPrice(priceRange.max);
        activeFiltersList.append(`
          <span class="active-filter-badge" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: #fff; border: 1px solid #2196F3; border-radius: 12px; font-size: 12px;">
            <span>Price: ${minFormatted} - ${maxFormatted}</span>
            <button type="button" class="clear-filter-btn" data-filter="price" style="background: none; border: none; color: #2196F3; cursor: pointer; font-size: 14px; padding: 0; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; line-height: 1;">&times;</button>
          </span>
        `);
        hasFilters = true;
      }
      
      // Show/hide active filters container
      if (hasFilters) {
        activeFiltersContainer.show();
      } else {
        activeFiltersContainer.hide();
      }
      
      // Handle clear filter buttons
      $('.clear-filter-btn').off('click').on('click', function() {
        const filterType = $(this).data('filter');
        
        if (filterType === 'category') {
          // Remove category from URL
          const urlParams = new URLSearchParams(window.location.search);
          urlParams.delete('category');
          const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
          window.history.pushState({}, '', newUrl);
          currentPage = 1;
          loadProducts();
        } else if (filterType === 'price') {
          // Reset price filter to full range
          const minInput = $('#price-min-input');
          const maxInput = $('#price-max-input');
          minInput.val(100);
          maxInput.val(maxPrice > 0 ? maxPrice : 1000);
          priceRange.min = 100;
          priceRange.max = maxPrice > 0 ? maxPrice : 1000;
          currentPage = 1;
          displayProducts();
        }
      });
    }
    
    // Update product count display
    function updateProductCount() {
      // Use filteredProducts.length for the "of" count (products after price filter)
      // But ensure we show accurate pagination info
      const total = filteredProducts.length > 0 ? filteredProducts.length : (totalProductsCount > 0 ? totalProductsCount : 0);
      const start = Math.min((currentPage - 1) * itemsPerPage + 1, total);
      const end = Math.min(currentPage * itemsPerPage, total);
      
      // Show accurate count - use totalProductsCount if it's available, otherwise use filtered count
      const displayTotal = totalProductsCount > 0 ? totalProductsCount : total;
      
      if (total > 0) {
        $('.count-result').html(`<span>${start}-${end} </span> Product Found of <span> ${displayTotal}</span>`);
      } else {
        $('.count-result').html(`<span>0 </span> Product Found of <span> 0</span>`);
      }
    }
    
    // Load products
    async function loadProducts() {
      try {
        // Get category and page from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const categoryId = urlParams.get('category');
        const searchKeyword = urlParams.get('search') || '';
        const pageParam = urlParams.get('page');
        currentPage = pageParam ? parseInt(pageParam) : 1;
        
        // Ensure currentPage is valid
        if (isNaN(currentPage) || currentPage < 1) {
          currentPage = 1;
        }
        
        // Ensure search keyword is preserved in URL if it exists
        if (searchKeyword && !window.location.search.includes('search=')) {
          urlParams.set('search', searchKeyword);
          const newUrl = window.location.pathname + '?' + urlParams.toString();
          window.history.replaceState({}, '', newUrl);
        }
        
        // Search results message will be handled in document.ready
        
        // Show loading state only if containers exist
        const containers = ['#products-container', '#products-container-list', '#products-container-two'];
        containers.forEach(containerId => {
          const container = $(containerId);
          if (container && container.length) {
            container.html('<div class="col-12"><p class="text-center">Loading products...</p></div>');
          }
        });
        
        // Fetch products with search keyword (API should filter by keyword)
        // Fetch more products to get accurate counts - use 1000 to get all products for counting
        const result = await window.fetchProducts(0, 1000, categoryId, searchKeyword);
        
        // Store total count from API before filtering
        totalProductsCount = (result && result.totalCount) ? result.totalCount : 0;
        
        if (result && result.items && result.items.length > 0) {
          let productsToShow = result.items;
          
          // If searching, don't filter by category (let API handle it)
          // Only filter by category if NOT searching
          if (categoryId && !searchKeyword) {
            productsToShow = result.items.filter(product => {
              const productCatId = String(product.categoryId || '');
              const filterCatId = String(categoryId || '');
              return productCatId === filterCatId;
            });
            // Update total count to reflect filtered category products
            totalProductsCount = productsToShow.length;
          }
          
          // Use all products (no image filter - will use default image if needed)
          let productsToDisplay = productsToShow;
          
          // If searching and no results, show message
          if (searchKeyword && productsToDisplay.length === 0) {
            $('#products-container').html('<div class="col-12"><p class="text-center">No products found for "' + searchKeyword + '".</p></div>');
            $('#products-container-list').html('<div class="col-12"><p class="text-center">No products found for "' + searchKeyword + '".</p></div>');
            $('#products-container-two').html('<div class="col-12"><p class="text-center">No products found for "' + searchKeyword + '".</p></div>');
            $('.pagination-area nav').html('');
            return;
          }
          
          // Sort products - prioritize search relevance if searching
          if (searchKeyword && searchKeyword.trim() !== '') {
            const searchTerm = searchKeyword.toLowerCase().trim();
            productsToDisplay.sort((a, b) => {
              const nameA = (a.name || '').toLowerCase();
              const nameB = (b.name || '').toLowerCase();
              const descriptionA = (a.description || '').toLowerCase();
              const descriptionB = (b.description || '').toLowerCase();
              
              // Calculate relevance score
              let scoreA = 0;
              let scoreB = 0;
              
              // Exact name match gets highest priority
              if (nameA === searchTerm) scoreA += 1000;
              if (nameB === searchTerm) scoreB += 1000;
              
              // Name starts with search term
              if (nameA.startsWith(searchTerm)) scoreA += 500;
              if (nameB.startsWith(searchTerm)) scoreB += 500;
              
              // Name contains search term
              if (nameA.includes(searchTerm)) scoreA += 100;
              if (nameB.includes(searchTerm)) scoreB += 100;
              
              // Description contains search term
              if (descriptionA.includes(searchTerm)) scoreA += 50;
              if (descriptionB.includes(searchTerm)) scoreB += 50;
              
              // If same relevance, sort by date (newest first)
              if (scoreA === scoreB) {
                const dateA = new Date(a.creationTime || a.lastModificationTime || 0);
                const dateB = new Date(b.creationTime || b.lastModificationTime || 0);
                return dateB - dateA;
              }
              
              // Sort by relevance score (highest first)
              return scoreB - scoreA;
            });
          } else {
            // Sort by creation date descending when not searching
            productsToDisplay.sort((a, b) => {
              const dateA = new Date(a.creationTime || a.lastModificationTime || 0);
              const dateB = new Date(b.creationTime || b.lastModificationTime || 0);
              return dateB - dateA;
            });
          }
          
          // Store all products
          allProducts = productsToDisplay;
          
          // Calculate min and max prices
          // Min is always LKR 100
          minPrice = 100;
          
          if (allProducts.length > 0) {
            const prices = allProducts.map(product => {
              return product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
            }).filter(price => price > 0); // Exclude zero prices from min/max calculation
            
            if (prices.length > 0) {
              // Get the maximum price from products
              const calculatedMaxPrice = Math.ceil(Math.max(...prices));
              
              // Max defaults to LKR 1000, but if products have prices > 1000, use the highest price
              maxPrice = Math.max(1000, calculatedMaxPrice);
            } else {
              // No valid prices found, use default max
              maxPrice = 1000;
            }
          } else {
            // No products, use default max
            maxPrice = 1000;
          }
            
            // Reset price range to show all products initially (set to full range)
            // This ensures products aren't filtered out on initial load
            // Min is always 100, max is the calculated maxPrice
            if (!window.priceSliderInitialized) {
              priceRange.min = 100; // Always start at LKR 100
              priceRange.max = maxPrice;
              
              // Initialize price filter input fields
              if (!window.priceSliderInitialized) {
                initializePriceFilter();
                window.priceSliderInitialized = true;
              } else {
                // Update input fields with new max value if it changed
                const maxInput = $('#price-max-input');
                if (maxInput.length) {
                  maxInput.attr('max', maxPrice);
                  // Only update max value if current value is higher than new max
                  const currentMax = parseFloat(maxInput.val()) || maxPrice;
                  if (currentMax > maxPrice) {
                    maxInput.val(maxPrice);
                  }
                }
              }
            } else {
              // Update price filter input fields with new max value
              const maxInput = $('#price-max-input');
              
              if (maxInput.length) {
                // Only update max value if current value is higher than new max
                const currentMax = parseFloat(maxInput.val());
                if (!isNaN(currentMax) && currentMax > maxPrice && maxPrice > 0) {
                  maxInput.val(maxPrice);
                  priceRange.max = maxPrice;
                } else if (isNaN(currentMax) || currentMax === 0) {
                  // If field is empty, set to new max
                  maxInput.val(maxPrice);
                }
              }
            }
          
          // Display products for current page (this will show search results)
          displayProducts();
          
          // Ensure search parameter stays in URL and prevent any reloads
          if (searchKeyword && searchKeyword.trim() !== '') {
            const currentUrlParams = new URLSearchParams(window.location.search);
            const currentSearch = currentUrlParams.get('search');
            if (!currentSearch || currentSearch !== searchKeyword) {
              currentUrlParams.set('search', searchKeyword);
              const newUrl = window.location.pathname + '?' + currentUrlParams.toString();
              // Use replaceState to avoid triggering page reload
              window.history.replaceState({ search: searchKeyword }, '', newUrl);
            }
            // Ensure search inputs are populated
            setTimeout(function() {
              $('#search').val(searchKeyword);
              $('#search-input').val(searchKeyword);
              $('#search-results-message').show();
              $('#search-term-display').text(searchKeyword);
            }, 100);
          }
        } else {
          // No products found - show message but preserve search parameter
          const noResultsMessage = searchKeyword 
            ? `No products found for "${searchKeyword}".` 
            : 'No products found.';
          $('#products-container').html('<div class="col-12"><p class="text-center">' + noResultsMessage + '</p></div>');
          $('#products-container-list').html('<div class="col-12"><p class="text-center">' + noResultsMessage + '</p></div>');
          $('#products-container-two').html('<div class="col-12"><p class="text-center">' + noResultsMessage + '</p></div>');
          $('.pagination-area nav').html('');
          
          // Ensure search parameter stays in URL even when no results
          if (searchKeyword && searchKeyword.trim() !== '') {
            const currentUrlParams = new URLSearchParams(window.location.search);
            if (!currentUrlParams.get('search') || currentUrlParams.get('search') !== searchKeyword) {
              currentUrlParams.set('search', searchKeyword);
              const newUrl = window.location.pathname + '?' + currentUrlParams.toString();
              window.history.replaceState({}, '', newUrl);
            }
          }
        }
      } catch (error) {
        console.error('Error loading products:', error);
        const errorMessage = '<div class="col-12"><p class="text-center">Error loading products. Please try again later.</p></div>';
        const containers = ['#products-container', '#products-container-list', '#products-container-two'];
        containers.forEach(containerId => {
          const container = $(containerId);
          if (container && container.length) {
            container.html(errorMessage);
          }
        });
        const paginationNav = $('.pagination-area nav');
        if (paginationNav && paginationNav.length) {
          paginationNav.html('');
        }
      }
    }
    
    async function loadProductCategories() {
      try {
        // Check if categories container exists
        const categoriesContainer = $('#product-categories-list');
        if (!categoriesContainer || !categoriesContainer.length) {
          setTimeout(function() {
            loadProductCategories();
          }, 300);
          return;
        }
        
        const categories = await window.fetchCategories();
        
        if (categories && categories.length > 0) {
          // Fetch all products to calculate accurate category counts
          try {
            const allProductsResult = await window.fetchProducts(0, 1000, null, '');
            if (allProductsResult && allProductsResult.items) {
              // Calculate product count for each category
              categories.forEach(category => {
                const categoryId = String(category.id || '');
                category.productCount = allProductsResult.items.filter(product => {
                  const productCatId = String(product.categoryId || '');
                  return productCatId === categoryId;
                }).length;
              });
            }
          } catch (error) {
            // Continue with API-provided counts or 0
          }
          
          renderCategories(categories);
        } else {
          categoriesContainer.html('<li>No categories found</li>');
        }
      } catch (error) {
        console.error('Error loading categories:', error);
        const categoriesContainer = $('#product-categories-list');
        if (categoriesContainer && categoriesContainer.length) {
          categoriesContainer.html('<li>Error loading categories</li>');
        }
      }
    }
    
    // Initialize price filter input fields
    function initializePriceFilter() {
      const minInput = $('#price-min-input');
      const maxInput = $('#price-max-input');
      const applyButton = $('#apply-price-filter');
      
      if (!minInput.length || !maxInput.length) {
        return;
      }
      
      // Set initial values - min is always 100, max is calculated maxPrice
      const initialMin = 100;
      const initialMax = maxPrice > 0 ? maxPrice : 1000;
      
      // Set initial input values (users can clear and change these freely)
      minInput.val(initialMin);
      maxInput.val(initialMax);
      
      // Set initial price range (shows all products initially)
      priceRange.min = initialMin;
      priceRange.max = initialMax;
      
      // Handle apply button click
      applyButton.on('click', function() {
        applyPriceFilter();
      });
      
      // Handle Enter key on input fields
      minInput.on('keypress', function(e) {
        if (e.which === 13) { // Enter key
          e.preventDefault();
          applyPriceFilter();
        }
      });
      
      maxInput.on('keypress', function(e) {
        if (e.which === 13) { // Enter key
          e.preventDefault();
          applyPriceFilter();
        }
      });
      
      // No real-time validation - allow users to clear and type freely
      // Validation only happens when applying the filter
    }
    
    // Apply price filter from input fields
    function applyPriceFilter() {
      const minInput = $('#price-min-input');
      const maxInput = $('#price-max-input');
      
      // Get values from inputs - allow empty values (will use defaults)
      let minVal = parseFloat(minInput.val());
      let maxVal = parseFloat(maxInput.val());
      
      // If min is empty or invalid, use 100 as default
      if (isNaN(minVal) || minVal < 100) {
        minVal = 100;
        minInput.val(minVal);
      }
      
      // If max is empty or invalid, use maxPrice as default
      if (isNaN(maxVal) || maxVal < minVal) {
        maxVal = maxPrice > 0 ? maxPrice : 1000;
        maxInput.val(maxVal);
      }
      
      // Ensure values are within valid range
      const validMin = Math.max(100, minVal);
      const validMax = Math.max(validMin, Math.min(maxVal, maxPrice > 0 ? maxPrice : 10000));
      
      // Update input values if they were adjusted
      if (minVal !== validMin) {
        minInput.val(validMin);
      }
      if (maxVal !== validMax) {
        maxInput.val(validMax);
      }
      
      // Update price range for filtering
      priceRange.min = validMin;
      priceRange.max = validMax;
      
      // Reset to first page and filter products
      currentPage = 1;
      displayProducts();
    }
    
    // Render categories with product counts
    function renderCategories(categories) {
      const categoriesList = $('#product-categories-list');
      if (!categoriesList || !categoriesList.length) {
        return;
      }
      
      categoriesList.empty();
      
      // Get current category and search from URL
      const urlParams = new URLSearchParams(window.location.search);
      const currentCategoryId = urlParams.get('category');
      const searchKeyword = urlParams.get('search') || '';
      
      categories.forEach(category => {
        // Preserve search parameter when clicking categories
        const newParams = new URLSearchParams();
        if (category.id) {
          newParams.set('category', category.id);
        }
        if (searchKeyword) {
          newParams.set('search', searchKeyword);
        }
        const queryString = newParams.toString();
        const categoryLink = `shop${queryString ? '?' + queryString : ''}`;
        const isActive = currentCategoryId && String(category.id) === String(currentCategoryId);
        const activeClass = isActive ? 'active' : '';
        const listItem = $(`
          <li><a href="${categoryLink}" class="${activeClass}">${category.name} <span>(${category.productCount || 0})</span></a></li>
        `);
        
        // Prevent default navigation and handle with JavaScript to avoid scroll to top
        listItem.find('a').on('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Update URL without page reload
          const urlToNavigate = $(this).attr('href');
          if (urlToNavigate) {
            // Parse the URL to get query parameters
            const url = new URL(urlToNavigate, window.location.origin);
            const categoryId = url.searchParams.get('category');
            const searchKeyword = url.searchParams.get('search') || '';
            
            // Update URL without reloading page
            window.history.pushState({ category: categoryId }, '', urlToNavigate);
            
            // Reset to first page
            currentPage = 1;
            
            // Load products with new category
            loadProducts();
            
            // Update active category styling
            $('#product-categories-list li a').removeClass('active');
            $(this).addClass('active');
          }
          
          // Prevent scroll to top by returning false
          return false;
        });
        
        categoriesList.append(listItem);
      });
    }
    
    // Clear search function
    function clearSearch() {
      // Clear search inputs
      $('#search').val('');
      $('#search-input').val('');
      // Reload page without search parameter
      window.location.href = 'shop';
    }
    
    // Make clearSearch available globally
    window.clearSearch = clearSearch;
    
    // Handle browser back/forward buttons
    window.addEventListener('popstate', function(event) {
      // When user uses browser back/forward, reload products based on current URL
      currentPage = 1;
      loadProducts();
    });
    
    // Initialize on page load
    $(document).ready(function() {
      // Always initialize - load categories first, then products
      // Categories don't depend on product containers
      initializePage();
    });
    
    // Separate initialization function for better error handling
    function initializePage() {
      // Populate search inputs when page loads
      const urlParams = new URLSearchParams(window.location.search);
      const searchKeyword = urlParams.get('search') || '';
      
      if (searchKeyword) {
        // Keep search term visible in inputs
        $('#search').val(searchKeyword);
        $('#search-input').val(searchKeyword);
        // Show search results message
        $('#search-results-message').show();
        $('#search-term-display').text(searchKeyword);
      } else {
        // Clear search inputs and hide message when no search
        $('#search').val('');
        $('#search-input').val('');
        $('#search-results-message').hide();
      }
      
      // Prevent default price slider initialization from rangeSlider.js
      // We'll initialize it after products are loaded with correct min/max values
      const originalSliderInit = window.noUiSlider;
      if (originalSliderInit) {
        // Store reference but don't auto-initialize
        window.noUiSlider = originalSliderInit;
      }
      
      // Reset state to ensure clean initialization
      allProducts = [];
      filteredProducts = [];
      currentPage = 1;
      
      // Load categories first (they don't depend on product containers)
      loadProductCategories().catch(function(error) {
        console.error('Error loading categories:', error);
      });
      
      // Check if product containers exist before loading products
      const productContainers = ['#products-container', '#products-container-list', '#products-container-two'];
      const productContainersExist = productContainers.every(id => $(id).length > 0);
      
      if (productContainersExist) {
        // Load products if containers are ready
        loadProducts().catch(function(error) {
          console.error('Error in loadProducts:', error);
        });
      } else {
        // Retry loading products after a short delay if containers aren't ready
        setTimeout(function() {
          if (productContainers.every(id => $(id).length > 0)) {
            loadProducts().catch(function(error) {
              console.error('Error in loadProducts after retry:', error);
            });
          } else {
            // Still try to load products - displayProducts will handle empty containers
            loadProducts().catch(function(error) {
              console.error('Error in loadProducts (final attempt):', error);
            });
          }
        }, 500);
      }
      
      // Update cart count
      if (typeof window.CartService !== 'undefined') {
        window.CartService.updateCartCount();
      }

      // Function to show quick view modal with product data
      function showQuickViewModal(product) {
        const productName = product.name || 'Product Name';
        
        // Get price - handle null, undefined, and 0 values properly
        let productPrice = 0;
        
        // Check sellingPrice first
        if (product.sellingPrice !== null && product.sellingPrice !== undefined) {
          if (product.sellingPrice > 0) {
            productPrice = product.sellingPrice;
          } else if (product.unitPrice !== null && product.unitPrice !== undefined && product.unitPrice > 0) {
            productPrice = product.unitPrice;
          } else {
            productPrice = product.sellingPrice; // Use even if 0
          }
        } 
        // If no sellingPrice, check unitPrice
        else if (product.unitPrice !== null && product.unitPrice !== undefined) {
          productPrice = product.unitPrice;
        }
        
        const productDescription = product.description || 'No description available.';
        // Use formatPrice function with thousand separators
        const formattedPrice = window.formatPrice ? window.formatPrice(productPrice) : (productPrice > 0 ? 'LKR ' + parseFloat(productPrice).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') : 'Price not available');
        
        // Handle images - use images array if available, otherwise fallback to imageUrl/imageURL
        let productImages = [];
        let mainImage = 'https://www.holoimage.net/images/no-image.jpg';
        
        if (product.images && Array.isArray(product.images) && product.images.length > 0) {
          // Use images array - first image as main, all as thumbnails
          productImages = product.images.map(img => img.imageUrl || img.imageURL).filter(url => url);
          if (productImages.length > 0) {
            mainImage = productImages[0];
          }
        } else if (product.imageUrls && Array.isArray(product.imageUrls) && product.imageUrls.length > 0) {
          // Fallback to imageUrls array
          productImages = product.imageUrls.filter(url => url);
          if (productImages.length > 0) {
            mainImage = productImages[0];
          }
        } else {
          // Fallback to single imageUrl/imageURL
          const singleImage = product.imageUrl || product.imageURL;
          if (singleImage) {
            mainImage = singleImage;
            productImages = [singleImage];
          }
        }
        
        // Update modal main image
        $('#quick-view-main-image').attr('src', mainImage).attr('alt', productName);
        
        // Update thumbnails
        const thumbnailsContainer = $('#quick-view-thumbnails');
        thumbnailsContainer.empty();
        
        // Show thumbnails if there are multiple images
        if (productImages.length > 1) {
          thumbnailsContainer.show(); // Ensure container is visible
          productImages.forEach((imageUrl, index) => {
            const isActive = index === 0 ? 'active' : '';
            const thumbnailHtml = `
              <div class="thumbnail-item ${isActive}" data-image-index="${index}">
                <img src="${imageUrl}" alt="${productName} - Image ${index + 1}">
              </div>
            `;
            thumbnailsContainer.append(thumbnailHtml);
          });
          
          // Add click handlers for thumbnails
          thumbnailsContainer.off('click', '.thumbnail-item').on('click', '.thumbnail-item', function() {
            const $this = $(this);
            const imageUrl = $this.find('img').attr('src');
            
            // Update main image
            $('#quick-view-main-image').attr('src', imageUrl);
            
            // Update active state
            thumbnailsContainer.find('.thumbnail-item').removeClass('active');
            $this.addClass('active');
          });
        } else {
          // Hide thumbnails container if only one image
          thumbnailsContainer.hide();
        }
        
        // Update modal content
        const modalContent = `
          <div class="single-product-info">
            <h4 class="title">${productName}</h4>
            <div class="prices">
              <span class="price">${formattedPrice}</span>
            </div>
            <div class="product-rating">
              <div class="rating">
                <span class="fa fa-star"></span>
                <span class="fa fa-star"></span>
                <span class="fa fa-star"></span>
                <span class="fa fa-star"></span>
                <span class="fa fa-star"></span>
              </div>
            </div>
            <p class="product-desc">${productDescription}</p>
            <div class="quick-product-action">
              <div class="action-top">
                <div class="pro-qty">
                  <input type="text" id="modal-quantity" title="Quantity" value="1" min="1" />
                </div>
                <button class="btn btn-theme add-to-cart-btn" data-product='${JSON.stringify(product)}'>Add to Cart</button>
                <a class="btn-wishlist add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(product)}">Add to Wishlist</a>
              </div>
            </div>
          </div>
        `;
        
        $('#quick-view-content').html(modalContent);
        
        // Initialize quantity buttons for the modal
        const modalProQty = $('#quick-view-content .pro-qty');
        if (modalProQty.length > 0 && modalProQty.find('.qty-btn').length === 0) {
          modalProQty.append('<a href="#" class="inc qty-btn"><i class="fa fa-plus"></i></a>');
          modalProQty.append('<a href="#" class="dec qty-btn"><i class="fa fa-minus"></i></a>');
        }
        
        // Show modal
        $('.product-quick-view-modal').addClass('active');
        $('body').addClass('fix');
      }

      // Handle quick view modal - use event delegation for dynamically created elements
      $(document).on('click', '.quick-view-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const productDataStr = $(this).attr('data-product');
        if (!productDataStr) return;
        
        try {
          const product = JSON.parse(productDataStr);
          
          // Always try to get the full product data (including images) from the product list
          // Try to find the full product from allProducts array
          if (typeof allProducts !== 'undefined' && allProducts.length > 0) {
            const fullProduct = allProducts.find(p => p.id === product.id);
            if (fullProduct) {
              Object.assign(product, fullProduct);
            }
          } else if (typeof window.homeProducts !== 'undefined' && window.homeProducts.length > 0) {
            const fullProduct = window.homeProducts.find(p => p.id === product.id);
            if (fullProduct) {
              Object.assign(product, fullProduct);
            }
          }
          
          showQuickViewModal(product);
        } catch (error) {
          console.error('Error parsing product data:', error);
        }
      });

      // Close modal handlers (if not already handled by custom.js)
      $(document).on('click', '.product-quick-view-modal .btn-close, .canvas-overlay', function() {
        $('.product-quick-view-modal').removeClass('active');
        $('body').removeClass('fix');
      });
      
      // Handle quantity buttons in modal (event delegation for dynamically created elements)
      $(document).on('click', '.product-quick-view-modal .qty-btn', function(e) {
        e.preventDefault();
        const $button = $(this);
        const $input = $button.parent().find('input');
        const oldValue = parseInt($input.val()) || 1;
        
        if ($button.hasClass('inc')) {
          const newVal = oldValue + 1;
          $input.val(newVal);
        } else if ($button.hasClass('dec')) {
          if (oldValue > 1) {
            const newVal = oldValue - 1;
            $input.val(newVal);
          } else {
            $input.val(1);
          }
        }
      });
    }
    
  })(jQuery);
  </script>

</body>

</html>
