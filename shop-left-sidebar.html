<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/">

    <title>Shop - Kidol - Kids Toys Store eCommerce HTML Template</title>

    <!--== Favicon ==-->
    <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon" />

    <!--== Google Fonts ==-->
    <link href="https://fonts.googleapis.com/css?family=Fredoka+One:400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!--== Bootstrap CSS ==-->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <!--== Font-awesome Icons CSS ==-->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet"/>
    <!--== Pe Icon 7 Min Icons CSS ==-->
    <link href="/assets/css/pe-icon-7-stroke.min.css" rel="stylesheet"/>
    <!--== Ionicons CSS ==-->
    <link href="/assets/css/ionicons.css" rel="stylesheet"/>
    <!--== Animate CSS ==-->
    <link href="/assets/css/animate.css" rel="stylesheet"/>
    <!--== Aos CSS ==-->
    <link href="/assets/css/aos.css" rel="stylesheet"/>
    <!--== FancyBox CSS ==-->
    <link href="/assets/css/jquery.fancybox.min.css" rel="stylesheet"/>
    <!--== Slicknav CSS ==-->
    <link href="/assets/css/slicknav.css" rel="stylesheet"/>
    <!--== Swiper CSS ==-->
    <link href="/assets/css/swiper.min.css" rel="stylesheet"/>
    <!--== Slick CSS ==-->
    <link href="/assets/css/slick.css" rel="stylesheet"/>
    <!--== Rangeslider CSS ==-->
    <link href="/assets/css/rangeslider.css" rel="stylesheet"/>
    <!--== Main Style CSS ==-->
    <link href="/assets/css/style.css" rel="stylesheet" />

</head>

<body>

<!--wrapper start-->
<div class="wrapper page-shop-wrapper">

  <!--== Start Header Wrapper ==-->
  <header class="header-wrapper">
    <div class="header-top">
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-sm-5 col-md-4 col-lg-6">
            <div class="header-info-left">
              <p>Free Returns and Free Shipping</p>
            </div>
          </div>
          <div class="col-xs-12 col-sm-7 col-md-8 col-lg-6 sm-pl-0 xs-pl-15 header-top-right">
            <div class="header-info">
              <a href="tel://+00123456789"><i class="fa fa-phone"></i> +00 123 456 789</a>
              <a href="mailto://demo@example.com"><i class="fa fa-envelope"></i> demo@example.com</a>
              <a href="login-register.html"><i class="fa fa-user"></i> Account</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-middle">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-12">
            <div class="header-align">
              <div class="header-align-left">
                <div class="header-logo-area">
                  <a href="index.html">
                    <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                    <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
                  </a>
                </div>
              </div>
              <div class="header-align-center">
                <div class="header-search-box">
                  <form action="#" method="post">
                    <div class="form-input-item">
                      <label for="search" class="sr-only">Search Everything</label>
                      <input type="text" id="search" placeholder="Search Everything">
                      <button type="submit" class="btn-src">
                        <i class="pe-7s-search"></i>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="header-align-right">
                <div class="header-action-area">
                  <div class="header-action-wishlist">
                    <button class="btn-wishlist" onclick="window.location.href='shop-wishlist.html'">
                      <i class="pe-7s-like"></i>
                    </button>
                  </div>
                  <div class="header-action-cart">
                    <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart.html'">
                      <span class="cart-count">01</span>
                      <i class="pe-7s-shopbag"></i>
                    </button>
                  </div>
                  <button class="btn-menu d-md-none">
                    <i class="fa fa-bars"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-area header-default sticky-header">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-4 col-sm-6 col-lg-2">
            <div class="header-logo-area">
              <a href="index.html">
                <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
              </a>
            </div>
          </div>
          <div class="col-lg-8 sticky-md-none">
            <div class="header-navigation-area d-none d-md-block">
              <ul class="main-menu nav position-relative">
                <li class="active"><a class="ml--2" href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <!-- <li class="has-submenu"><a href="index.html">Pages</a>
                  <ul class="submenu-nav">
                    <li><a href="shop-cart.html">Cart page</a></li>
                    <li><a href="shop-checkout.html">Checkout</a></li>
                    <li><a href="my-account.html">My Account</a></li>
                    <li><a href="shop-wishlist.html">Wishlist</a></li>
                    <li><a href="shop-compare.html">Compare</a></li>
                    <li><a href="login-register.html">Login / Register</a></li>
                    <li><a href="coming-soon.html">Coming soon</a></li>
                    <li><a href="page-not-found.html">404</a></li>
                  </ul>
                </li> -->
                <li><a href="shop-left-sidebar.html">Shop</a></li>
                <li><a href="blog-4-column.html">Blog</a></li>
                <li><a href="contact.html">Contact</a></li>
              </ul>
            </div>
          </div>
          <div class="col-8 col-sm-6 col-lg-2">
            <div class="header-action-area">
              <div class="header-action-search">
                <button class="btn-search btn-search-menu">
                  <i class="pe-7s-search"></i>
                </button>
              </div>
              <div class="header-action-login">
                <button class="btn-login" onclick="window.location.href='login-register.html'">
                  <i class="pe-7s-users"></i>
                </button>
              </div>
              <div class="header-action-wishlist">
                <button class="btn-wishlist" onclick="window.location.href='shop-wishlist.html'">
                  <i class="pe-7s-like"></i>
                </button>
              </div>
              <div class="header-action-cart">
                <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart.html'">
                  <span class="cart-count">01</span>
                  <i class="pe-7s-shopbag"></i>
                </button>
              </div>
              <button class="btn-menu d-lg-none">
                <i class="fa fa-bars"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--== End Header Wrapper ==-->
  
  <main class="main-content">
    <!--== Start Page Title Area ==-->
    <section class="page-title-area">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-12 m-auto">
            <div class="page-title-content text-center">
              <h2 class="title">Product</h2>
              <div class="bread-crumbs"><a href="index.html"> Home </a><span class="breadcrumb-sep"> // </span><span class="active"> Product</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--== End Page Title Area ==-->

    <!--== Start Shop Area Wrapper ==-->
    <div class="product-area product-grid-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-9 order-0 order-lg-1">
            <div class="shop-content">
              <div class="shop-toolbar-wrap">
                <div class="product-showing-status">
                  <p class="count-result"><span>12 </span> Product Found of <span> 30</span></p>
                </div>
                <div class="product-view-mode">
                  <nav>
                    <div class="nav nav-tabs active" id="nav-tab" role="tablist">
                      <button class="nav-link active" id="column-three-tab" data-bs-toggle="tab" data-bs-target="#column-three" type="button" role="tab" aria-controls="column-three" aria-selected="true"><i class="fa fa-th"></i></button>

                      <button class="nav-link" id="nav-list-tab" data-bs-toggle="tab" data-bs-target="#nav-list" type="button" role="tab" aria-controls="nav-list" aria-selected="false"><i class="fa fa-list"></i></button>

                      <button class="nav-link" id="column-two-tab" data-bs-toggle="tab" data-bs-target="#column-two" type="button" role="tab" aria-controls="column-two" aria-selected="true"><i class="fa fa-th-large"></i></button>
                    </div>
                  </nav>
                </div>
                <div class="product-sorting-menu product-sorting">
                  <span class="current">Sort By : <span> Default <i class="fa fa-angle-down"></i></span></span>
                  <ul>
                    <li class="active"><a href="shop.html" class="active">Sort by Default</a></li>
                    <li><a href="shop.html">Sort by Popularity</a></li>
                    <li><a href="shop.html">Sort by Rated</a></li>
                    <li><a href="shop.html">Sort by Latest</a></li>
                    <li><a href="shop.html">Sort by Price: <i class="lastudioicon-arrow-up"></i></a></li>
                    <li><a href="shop.html">Sort by Price: <i class="lastudioicon-arrow-down"></i></a></li>
                  </ul>
                </div>
              </div>
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="column-three" role="tabpanel" aria-labelledby="column-three-tab">
                  <div class="row" id="products-container">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
                <div class="tab-pane fade" id="nav-list" role="tabpanel" aria-labelledby="nav-list-tab">
                  <div class="row" id="products-container-list">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
                <div class="tab-pane fade" id="column-two" role="tabpanel" aria-labelledby="column-two-tab">
                  <div class="row" id="products-container-two">
                    <!-- Products will be loaded dynamically here -->
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <div class="pagination-area mb-md-50">
                    <nav>
                      <!-- Pagination will be loaded dynamically here -->
                    </nav>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 order-1 order-lg-0">
            <div class="sidebar-area shop-sidebar-area">
              <div class="widget-item">
                <div class="widget-title">
                  <h3 class="title">Product Categories</h3>
                </div>
                <div class="widget-body">
                  <div class="widget-categories">
                    <ul id="product-categories-list">
                      <!-- Categories will be loaded dynamically here -->
                    </ul>
                  </div>
                </div>
              </div>
              <div class="widget-item">
                <div class="widget-filter">
                  <div class="widget-title">
                    <h3 class="title">Price Filter</h3>
                  </div>
                  <div class="widget-body">
                    <div class="widget-price-filter">
                      <div class="slider-labels">
                        <div class="caption">
                          <span id="slider-range-value1"></span>
                        </div>
                        <span class="range-separator"></span>
                        <div class="caption">
                          <span id="slider-range-value2"></span>
                        </div>
                      </div>
                      <div class="slider-range" id="slider-range"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--== End Shop Area Wrapper ==-->
  </main>

  <!--== Start Footer Area Wrapper ==-->
  <footer class="footer-area default-style" >
    <div class="footer-main">
      <div class="container">
        <div class="row">
          <div class="col-md-5 col-lg-3">
            <div class="widget-item item-style3">
              <div class="about-widget">
                <a class="footer-logo" href="index.html">
                  <img src="/assets/img/logo-light.png" alt="Logo">
                </a>
                <p>Lorem ipsum dolor sit amet, consecl adipisicing elit, sed do eiusmod teml incididunt ut labore et dolore magna aliqua Ut enim</p>
                <div class="widget-social-icons">
                  <a href="#"><i class="ion-social-twitter"></i></a>
                  <a href="#"><i class="ion-social-tumblr"></i></a>
                  <a href="#"><i class="ion-social-facebook"></i></a>
                  <a href="#"><i class="ion-social-instagram-outline"></i></a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-lg-2">
            <div class="widget-item item-style1">
              <h4 class="widget-title">Quick Links</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-1">Quick Links</h4>
              <div id="dividerId-1" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap">
                  <ul class="nav-menu nav item-hover-style">
                    <li><a href="index.html">- Support</a></li>
                    <li><a href="index.html">- Helpline</a></li>
                    <li><a href="index.html">- Courses</a></li>
                    <li><a href="about.html">- About</a></li>
                    <li><a href="index.html">- Event</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-2">
            <div class="widget-item item-style1">
              <h4 class="widget-title">Other Page</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-2">Other Page</h4>
              <div id="dividerId-2" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap item-hover-style">
                  <ul class="nav-menu nav">
                    <li><a href="about.html">- About</a></li>
                    <li><a href="blog.html">- Blog</a></li>
                    <li><a href="index.html">- Speakers</a></li>
                    <li><a href="index.html">- Contact</a></li>
                    <li><a href="index.html">- FAQ</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-md-12 col-lg-5">
            <div class="widget-item item-style2">
              <h4 class="widget-title">Newsletter</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-3">Newsletter</h4>
              <div id="dividerId-3" class="collapse widget-collapse-body">
                <div class="widget-newsletter">
                  <p>Get Updates About Our Latest Shop And Special Offers.</p>
                  <form class="newsletter-form" action="#">
                    <div class="form-group">
                      <input type="email" class="form-control" placeholder="Enter your email">
                      <button class="btn-submit" type="submit"><i class="ion-ios-paperplane"></i></button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <div class="footer-bottom-content">
          <div class="row text-center">
            <div class="col-sm-12">
              <div class="widget-copyright">
                <p><i class="fa fa-copyright"></i> 2021 <span>Sensory. </span> Made with <i class="fa fa-heart"></i> by <a target="_blank" href="https://www.hasthemes.com">HasThemes</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-shape bg-img" data-bg-img="/assets/img/photos/footer1.png"></div>
  </footer>
  <!--== End Footer Area Wrapper ==-->

</div>
<!--wrapper end-->
  
  <!--== Scroll Top Button ==-->
  <div class="scroll-to-top"><span class="fa fa-angle-double-up"></span></div>

  <!--== Start Product Quick View ==-->
  <aside class="product-quick-view-modal">
    <div class="product-quick-view-inner">
      <div class="product-quick-view-content">
        <button type="button" class="btn-close">
          <span class="pe-7s-close"><i class="lastudioicon-e-remove"></i></span>
        </button>
        <div class="row row-gutter-0">
          <div class="col-lg-6 col-md-6 col-12">
            <div class="thumb">
              <img src="/assets/img/shop/quick-view1.jpg" alt="Image">
            </div>
          </div>
          <div class="col-lg-6 col-md-6 col-12">
            <div class="content" id="quick-view-content">
              <!-- Quick view content will be loaded dynamically -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
  <!--== End Product Quick View ==-->

  <!--== Start Aside Cart ==-->
  <aside class="aside-cart-wrapper offcanvas offcanvas-end" tabindex="-1" id="AsideOffcanvasCart" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h1 class="d-none" id="offcanvasRightLabel">Shopping Cart</h1>
      <button class="btn-aside-cart-close" data-bs-dismiss="offcanvas" aria-label="Close">Shopping Cart <i class="ion-ios-close-empty"></i></button>
    </div>
    <div class="offcanvas-body">
      <ul class="aside-cart-product-list" id="aside-cart-items">
        <!-- Cart items will be loaded dynamically -->
      </ul>
      <div class="aside-cart-footer">
        <div class="cart-total">
          <h4>Total: <span id="aside-cart-total">LKR 0.00</span></h4>
        </div>
        <div class="group-btn">
          <a class="btn-product" href="shop-cart.html">View Cart</a>
          <a class="btn-product" href="shop-checkout.html">Checkout</a>
        </div>
      </div>
    </div>
  </aside>
  <!--== End Aside Cart ==-->

  <!--== Start Aside Search ==-->
  <aside class="aside-search-wrapper offcanvas offcanvas-top" tabindex="-1" id="AsideOffcanvasSearch" aria-labelledby="offcanvasTopLabel">
    <div class="offcanvas-header">
      <h5 class="d-none" id="offcanvasTopLabel">Aside Search</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"><i class="pe-7s-close"></i></button>
    </div>
    <div class="offcanvas-body">
      <div class="container pt--0 pb--0">
        <div class="search-box-form-wrap">
          <div class="search-note">
            <p>Start typing and press Enter to search</p>
          </div>
          <form action="#" method="post">
            <div class="search-form position-relative">
              <label for="search-input" class="visually-hidden">Search</label>
              <input id="search-input" type="search" class="form-control" placeholder="Search entire storeâ€¦">
              <button class="btn-search" type="submit"><i class="ion-ios-search-strong"></i></button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </aside>
  <!--== End Aside Search ==-->

  <!--== Start Aside Menu ==-->
  <aside class="aside-menu-wrapper offcanvas offcanvas-start" tabindex="-1" id="AsideOffcanvasMenu" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
      <h1 class="d-none" id="offcanvasExampleLabel">Aside Menu</h1>
      <button class="btn-aside-menu-close" data-bs-dismiss="offcanvas" aria-label="Close">Menu <i class="ion-ios-close-empty"></i></button>
    </div>
    <div class="offcanvas-body">
      <nav class="aside-menu-nav">
        <ul class="nav-menu">
          <li class="active"><a class="ml--2" href="index.html">Home</a></li>
          <li><a class="ml--2" href="shop-left-sidebar.html">Shop</a></li>
          <li><a class="ml--2" href="blog-4-column.html">Blog</a></li>
          <li><a class="ml--2" href="about.html">About</a></li>
          <li><a class="ml--2" href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </aside>
  <!--== End Aside Menu ==-->

  <!-- JS Vendor, Plugins & Activation Script Files -->
  <script src="/assets/js/jquery-main.js"></script>
  <script src="/assets/js/jquery-migrate.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/popper.min.js"></script>
  <script src="/assets/js/jquery.slicknav.js"></script>
  <script src="/assets/js/swiper.min.js"></script>
  <script src="/assets/js/fancybox.min.js"></script>
  <script src="/assets/js/slick.min.js"></script>
  <script src="/assets/js/rangeSlider.js"></script>
  <script src="/assets/js/jquery-zoom.min.js"></script>
  <script src="/assets/js/isotope.pkgd.min.js"></script>
  <script src="/assets/js/aos.min.js"></script>
  <script src="/assets/js/wow.min.js"></script>
  <script src="/assets/js/parallax.min.js"></script>
  <script src="/assets/js/jquery.appear.js"></script>
  <script src="/assets/js/jquery.countdown.min.js"></script>
  <script src="/assets/js/tippy.all.min.js"></script>
  <script src="/assets/js/custom.js"></script>
  <script src="/assets/js/cart-service.js"></script>
  <script src="/assets/js/config.js"></script>
  <script src="/assets/js/api-service.js"></script>
  <style>
    /* Toast Notification Styles */
    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 16px 24px;
      border-radius: 4px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideInRight 0.3s ease-out;
      font-size: 14px;
    }
    
    .toast-notification.success {
      background-color: #4CAF50;
    }
    
    .toast-notification.info {
      background-color: #2196F3;
    }
    
    .toast-notification .toast-icon {
      font-size: 20px;
    }
    
    .toast-notification .toast-message {
      flex: 1;
    }
    
    .toast-notification .toast-close {
      cursor: pointer;
      font-size: 18px;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    
    .toast-notification .toast-close:hover {
      opacity: 1;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    .toast-notification.hide {
      animation: slideOutRight 0.3s ease-out forwards;
    }
  </style>
  <script>
  (function($) {
    'use strict';

    // Toast notification function
    function showToast(message, type = 'success') {
      // Remove existing toasts
      $('.toast-notification').remove();
      
      const icon = type === 'success' ? '<i class="ion-checkmark-circled"></i>' : '<i class="ion-information-circled"></i>';
      const toast = $(`
        <div class="toast-notification ${type}">
          <span class="toast-icon">${icon}</span>
          <span class="toast-message">${message}</span>
          <span class="toast-close">&times;</span>
        </div>
      `);
      
      $('body').append(toast);
      
      // Auto hide after 3 seconds
      setTimeout(function() {
        toast.addClass('hide');
        setTimeout(function() {
          toast.remove();
        }, 300);
      }, 3000);
      
      // Close on click
      toast.find('.toast-close').on('click', function() {
        toast.addClass('hide');
        setTimeout(function() {
          toast.remove();
        }, 300);
      });
    }

    // Render products function
    function renderProducts(products, containerId) {
      const container = $(containerId);
      container.empty();
      
      if (!products || products.length === 0) {
        container.html('<div class="col-12"><p class="text-center">No products found.</p></div>');
        return;
      }
      
      // Filter products with imageURL
      const productsWithImages = products.filter(product => {
        return product.imageURL && product.imageURL.trim() !== '';
      });
      
      if (productsWithImages.length === 0) {
        container.html('<div class="col-12"><p class="text-center">No products with images found.</p></div>');
        return;
      }
      
      productsWithImages.forEach((product) => {
        const productImage = product.imageURL;
        const productPrice = product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
        const formattedPrice = formatPrice(productPrice);
        
        // Store minimal product data for cart/wishlist
        const productData = {
          id: product.id,
          name: product.name,
          imageURL: product.imageURL,
          sellingPrice: product.sellingPrice,
          unitPrice: product.unitPrice
        };
        
        // Determine column class based on container - 3 products per row
        let colClass = 'col-sm-6 col-md-4 col-lg-4';
        if (containerId === '#products-container-list') {
          colClass = 'col-12 product-items-list';
        } else if (containerId === '#products-container-two') {
          colClass = 'col-sm-6';
        }
        
        let productHtml = '';
        if (containerId === '#products-container-list') {
          // List view
          productHtml = `
            <div class="${colClass}">
              <div class="product-item">
                <div class="product-thumb">
                  <img src="${productImage}" alt="${product.name}">
                  <div class="product-action">
                    <a class="action-quick-view add-to-cart-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-ios-cart"></i></a>
                    <a class="action-quick-view" href="javascript:void(0)"><i class="ion-arrow-expand"></i></a>
                    <a class="action-quick-view add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-heart"></i></a>
                  </div>
                </div>
                <div class="product-info">
                  <div class="rating">
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                  </div>
                  <h4 class="title"><a href="shop-single-product.html?id=${product.id}">${product.name}</a></h4>
                  <div class="prices">
                    <span class="price">${formattedPrice}</span>
                  </div>
                  ${product.description ? `<p>${product.description}</p>` : ''}
                </div>
              </div>
            </div>
          `;
        } else {
          // Grid view
          productHtml = `
            <div class="${colClass}">
              <div class="product-item">
                <div class="product-thumb">
                  <img src="${productImage}" alt="${product.name}">
                  <div class="product-action">
                    <a class="action-quick-view add-to-cart-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-ios-cart"></i></a>
                    <a class="action-quick-view" href="javascript:void(0)"><i class="ion-arrow-expand"></i></a>
                    <a class="action-quick-view add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(productData)}'><i class="ion-heart"></i></a>
                  </div>
                </div>
                <div class="product-info">
                  <div class="rating">
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                    <span class="fa fa-star"></span>
                  </div>
                  <h4 class="title"><a href="shop-single-product.html?id=${product.id}">${product.name}</a></h4>
                  <div class="prices">
                    <span class="price">${formattedPrice}</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }
        
        container.append(productHtml);
      });
      
      // Attach event handlers
      attachEventHandlers();
    }
    
    // Format price
    function formatPrice(price) {
      if (!price || price === 0) return 'LKR 0.00';
      return 'LKR ' + parseFloat(price).toFixed(2);
    }
    
    // Attach event handlers for cart and wishlist
    function attachEventHandlers() {
      $(document).off('click', '.add-to-cart-btn').on('click', '.add-to-cart-btn', function(e) {
        e.preventDefault();
        const productData = JSON.parse($(this).attr('data-product'));
        if (window.CartService) {
          window.CartService.addToCart(productData);
          showToast('Product added to cart!', 'success');
        }
      });
      
      $(document).off('click', '.add-to-wishlist-btn').on('click', '.add-to-wishlist-btn', function(e) {
        e.preventDefault();
        const productData = JSON.parse($(this).attr('data-product'));
        if (window.CartService) {
          window.CartService.addToWishlist(productData);
          showToast('Product added to wishlist!', 'success');
        }
      });
    }
    
    // Pagination state
    let currentPage = 1;
    const itemsPerPage = 12;
    let allProducts = [];
    let filteredProducts = [];
    let minPrice = 0;
    let maxPrice = 0;
    let priceRange = { min: 0, max: 0 };
    
    // Render pagination
    function renderPagination(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const paginationHtml = `
        <ul class="page-numbers justify-content-end">
          ${currentPage > 1 ? `
            <li>
              <a class="page-number" href="javascript:void(0)" data-page="${currentPage - 1}">
                <i class="fa fa-angle-left"></i>
              </a>
            </li>
          ` : ''}
          ${Array.from({ length: totalPages }, (_, i) => i + 1).map(page => `
            <li>
              <a class="page-number ${page === currentPage ? 'active' : ''}" href="javascript:void(0)" data-page="${page}">${page}</a>
            </li>
          `).join('')}
          ${currentPage < totalPages ? `
            <li>
              <a class="page-number next" href="javascript:void(0)" data-page="${currentPage + 1}">
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
          ` : ''}
        </ul>
      `;
      $('.pagination-area nav').html(paginationHtml);
      
      // Attach pagination click handlers
      $('.page-number').off('click').on('click', function(e) {
        e.preventDefault();
        const page = parseInt($(this).attr('data-page'));
        if (page && page !== currentPage) {
          currentPage = page;
          
          // Update URL without page reload
          const urlParams = new URLSearchParams(window.location.search);
          urlParams.set('page', page);
          const newUrl = window.location.pathname + '?' + urlParams.toString();
          window.history.pushState({ page: page }, '', newUrl);
          
          displayProducts();
        }
      });
    }
    
    // Filter products by price range
    function filterProductsByPrice(products) {
      if (priceRange.min === 0 && priceRange.max === 0) {
        return products;
      }
      return products.filter(product => {
        const productPrice = product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
        return productPrice >= priceRange.min && productPrice <= priceRange.max;
      });
    }
    
    // Display products for current page
    function displayProducts() {
      // Apply price filter
      filteredProducts = filterProductsByPrice(allProducts);
      
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const productsToShow = filteredProducts.slice(startIndex, endIndex);
      
      // Render in all three containers
      renderProducts(productsToShow, '#products-container');
      renderProducts(productsToShow, '#products-container-list');
      renderProducts(productsToShow, '#products-container-two');
      
      // Render pagination
      renderPagination(filteredProducts.length);
      
      // Update product count
      updateProductCount();
      
      // Scroll to top
      $('html, body').animate({ scrollTop: 0 }, 300);
    }
    
    // Update product count display
    function updateProductCount() {
      const total = filteredProducts.length;
      const current = Math.min((currentPage - 1) * itemsPerPage + 1, total);
      const end = Math.min(currentPage * itemsPerPage, total);
      $('.count-result').html(`<span>${current}-${end} </span> Product Found of <span> ${total}</span>`);
    }
    
    // Load products
    async function loadProducts() {
      try {
        // Get category and page from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const categoryId = urlParams.get('category');
        const pageParam = urlParams.get('page');
        currentPage = pageParam ? parseInt(pageParam) : 1;
        
        // Show loading state
        $('#products-container').html('<div class="col-12"><p class="text-center">Loading products...</p></div>');
        $('#products-container-list').html('<div class="col-12"><p class="text-center">Loading products...</p></div>');
        $('#products-container-two').html('<div class="col-12"><p class="text-center">Loading products...</p></div>');
        
        // Fetch products
        const result = await window.fetchProducts(0, 100, categoryId);
        
        if (result && result.items && result.items.length > 0) {
          let productsToShow = result.items;
          
          // Client-side filtering by categoryId if provided
          if (categoryId) {
            productsToShow = result.items.filter(product => {
              const productCatId = String(product.categoryId || '');
              const filterCatId = String(categoryId || '');
              return productCatId === filterCatId;
            });
          }
          
          // Filter products with imageURL
          const productsWithImages = productsToShow.filter(product => {
            return product.imageURL && product.imageURL.trim() !== '';
          });
          
          // Sort by creation date descending
          productsWithImages.sort((a, b) => {
            const dateA = new Date(a.creationTime || a.lastModificationTime || 0);
            const dateB = new Date(b.creationTime || b.lastModificationTime || 0);
            return dateB - dateA;
          });
          
          // Store all products
          allProducts = productsWithImages;
          
          // Calculate min and max prices
          if (allProducts.length > 0) {
            const prices = allProducts.map(product => {
              return product.sellingPrice > 0 ? product.sellingPrice : (product.unitPrice > 0 ? product.unitPrice : 0);
            });
            minPrice = Math.floor(Math.min(...prices));
            maxPrice = Math.ceil(Math.max(...prices));
            
            // Initialize price filter if not already initialized
            if (!window.priceSliderInitialized) {
              initializePriceFilter();
              window.priceSliderInitialized = true;
            }
          }
          
          // Display products for current page
          displayProducts();
        } else {
          $('#products-container').html('<div class="col-12"><p class="text-center">No products found.</p></div>');
          $('#products-container-list').html('<div class="col-12"><p class="text-center">No products found.</p></div>');
          $('#products-container-two').html('<div class="col-12"><p class="text-center">No products found.</p></div>');
          $('.pagination-area nav').html('');
        }
      } catch (error) {
        console.error('Error loading products:', error);
        $('#products-container').html('<div class="col-12"><p class="text-center">Error loading products. Please try again later.</p></div>');
        $('#products-container-list').html('<div class="col-12"><p class="text-center">Error loading products. Please try again later.</p></div>');
        $('#products-container-two').html('<div class="col-12"><p class="text-center">Error loading products. Please try again later.</p></div>');
        $('.pagination-area nav').html('');
      }
    }
    
    async function loadProductCategories() {
      try {
        const categories = await window.fetchCategories();
        
        if (categories && categories.length > 0) {
          renderCategories(categories);
        } else {
          $('#product-categories-list').html('<li>No categories found</li>');
        }
      } catch (error) {
        console.error('Error loading categories:', error);
        $('#product-categories-list').html('<li>Error loading categories</li>');
      }
    }
    
    // Initialize price filter slider
    function initializePriceFilter() {
      if (minPrice === 0 && maxPrice === 0) return;
      
      // Check if slider already exists
      const sliderElement = document.getElementById('slider-range');
      if (!sliderElement) return;
      
      // Wait a bit to ensure rangeSlider.js has loaded and any default initialization completes
      setTimeout(function() {
        // Destroy existing slider if any (from default initialization)
        if (sliderElement.noUiSlider) {
          try {
            sliderElement.noUiSlider.destroy();
          } catch (e) {
            console.log('Slider already destroyed or not initialized');
          }
        }
        
        // Format for LKR currency
        let moneyFormat;
        let formatLKR;
        
        if (typeof wNumb !== 'undefined') {
          moneyFormat = wNumb({
            decimals: 0,
            thousand: ',',
            prefix: 'LKR '
          });
          formatLKR = function(value) {
            return moneyFormat.to(value);
          };
        } else {
          // Fallback formatting
          formatLKR = function(value) {
            return 'LKR ' + Math.round(value).toLocaleString();
          };
        }
        
        // Create slider
        try {
          const sliderOptions = {
            start: [minPrice, maxPrice],
            step: Math.max(1, Math.floor((maxPrice - minPrice) / 100)),
            range: {
              'min': [minPrice],
              'max': [maxPrice]
            },
            connect: true
          };
          
          if (moneyFormat) {
            sliderOptions.format = moneyFormat;
          }
          
          noUiSlider.create(sliderElement, sliderOptions);
          
          // Update display values
          sliderElement.noUiSlider.on('update', function(values, handle) {
            $('#slider-range-value1').html(formatLKR(values[0]));
            $('#slider-range-value2').html(formatLKR(values[1]));
            
            // Update price range for filtering
            if (moneyFormat) {
              priceRange.min = moneyFormat.from(values[0]);
              priceRange.max = moneyFormat.from(values[1]);
            } else {
              priceRange.min = Math.round(values[0]);
              priceRange.max = Math.round(values[1]);
            }
            
            // Reset to first page and filter products
            currentPage = 1;
            displayProducts();
          });
          
          // Set initial values
          $('#slider-range-value1').html(formatLKR(minPrice));
          $('#slider-range-value2').html(formatLKR(maxPrice));
          priceRange.min = minPrice;
          priceRange.max = maxPrice;
        } catch (error) {
          console.error('Error initializing price slider:', error);
        }
      }, 500);
    }
    
    // Render categories with product counts
    function renderCategories(categories) {
      const categoriesList = $('#product-categories-list');
      categoriesList.empty();
      
      // Get current category from URL
      const urlParams = new URLSearchParams(window.location.search);
      const currentCategoryId = urlParams.get('category');
      
      categories.forEach(category => {
        const categoryLink = `shop-left-sidebar.html${category.id ? '?category=' + category.id : ''}`;
        const isActive = currentCategoryId && String(category.id) === String(currentCategoryId);
        const activeClass = isActive ? 'active' : '';
        categoriesList.append(`
          <li><a href="${categoryLink}" class="${activeClass}">${category.name} <span>(${category.productCount || 0})</span></a></li>
        `);
      });
    }
    
    // Initialize on page load
    $(document).ready(function() {
      // Prevent default price slider initialization from rangeSlider.js
      // We'll initialize it after products are loaded with correct min/max values
      const originalSliderInit = window.noUiSlider;
      if (originalSliderInit) {
        // Store reference but don't auto-initialize
        window.noUiSlider = originalSliderInit;
      }
      
      loadProductCategories();
      loadProducts();
      
      // Update cart count
      if (typeof window.CartService !== 'undefined') {
        window.CartService.updateCartCount();
      }
    });
    
  })(jQuery);
  </script>

</body>

</html>
