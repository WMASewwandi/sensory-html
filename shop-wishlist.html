<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/">

    <title>Wishlist - Sensory - Kids Toys Store</title>

    <!--== Favicon ==-->
    <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon" />

    <!--== Google Fonts ==-->
    <link href="https://fonts.googleapis.com/css?family=Fredoka+One:400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!--== Bootstrap CSS ==-->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <!--== Font-awesome Icons CSS ==-->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet"/>
    <!--== Pe Icon 7 Min Icons CSS ==-->
    <link href="/assets/css/pe-icon-7-stroke.min.css" rel="stylesheet"/>
    <!--== Ionicons CSS ==-->
    <link href="/assets/css/ionicons.css" rel="stylesheet"/>
    <!--== Animate CSS ==-->
    <link href="/assets/css/animate.css" rel="stylesheet"/>
    <!--== Aos CSS ==-->
    <link href="/assets/css/aos.css" rel="stylesheet"/>
    <!--== FancyBox CSS ==-->
    <link href="/assets/css/jquery.fancybox.min.css" rel="stylesheet"/>
    <!--== Slicknav CSS ==-->
    <link href="/assets/css/slicknav.css" rel="stylesheet"/>
    <!--== Swiper CSS ==-->
    <link href="/assets/css/swiper.min.css" rel="stylesheet"/>
    <!--== Slick CSS ==-->
    <link href="/assets/css/slick.css" rel="stylesheet"/>
    <!--== Rangeslider CSS ==-->
    <link href="/assets/css/rangeslider.css" rel="stylesheet"/>
    <!--== Main Style CSS ==-->
    <link href="/assets/css/style.css" rel="stylesheet" />

</head>

<body>

<!--wrapper start-->
<div class="wrapper page-wishlist-wrapper">

  <!--== Start Preloader Content ==-->
  <div class="preloader-wrap">
    <div class="preloader">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!--== End Preloader Content ==-->

  <!--== Start Header Wrapper ==-->
  <header class="header-wrapper">
    <div class="header-top">
      <div class="container">
        <div class="row">
          <div class="col-xs-12 col-sm-5 col-md-4 col-lg-6">
            <div class="header-info-left">
            </div>
          </div>
          <div class="col-xs-12 col-sm-7 col-md-8 col-lg-6 sm-pl-0 xs-pl-15 header-top-right">
            <div class="header-info">
              <a href="tel://+94761487787"><i class="fa fa-phone"></i> +94761487787</a>
              <a href="mailto:sensorysl12@gmail.com"><i class="fa fa-envelope"></i> sensorysl12@gmail.com</a>
              <a href="login-register"><i class="fa fa-user"></i> Account</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-middle">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-12">
            <div class="header-align">
              <div class="header-align-left">
                <div class="header-logo-area">
                  <a href="/">
                    <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                    <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
                  </a>
                </div>
              </div>
              <div class="header-align-center">
                <div class="header-search-box">
                  <form action="#" method="post">
                    <div class="form-input-item">
                      <label for="search" class="sr-only">Search Everything</label>
                      <input type="text" id="search" placeholder="Search Everything">
                      <button type="submit" class="btn-src">
                        <i class="pe-7s-search"></i>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="header-align-right">
                <div class="header-action-area">
                  <div class="header-action-wishlist">
                    <button class="btn-wishlist" onclick="window.location.href='shop-wishlist'">
                      <span class="wishlist-count">0</span>
                      <i class="pe-7s-like"></i>
                    </button>
                  </div>
                  <div class="header-action-cart">
                    <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart'">
                      <span class="cart-count">0</span>
                      <i class="pe-7s-shopbag"></i>
                    </button>
                  </div>
                  <button class="btn-menu d-md-none">
                    <i class="ion-navicon"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-area header-default sticky-header">
      <div class="container">
        <div class="row row-gutter-0 align-items-center">
          <div class="col-4 col-sm-6 col-lg-2">
            <div class="header-logo-area">
              <a href="/">
                <img class="logo-main" src="/assets/img/logo.png" alt="Logo" />
                <img class="logo-light" src="/assets/img/logo.png" alt="Logo" />
              </a>
            </div>
          </div>
          <div class="col-lg-8 sticky-md-none">
            <div class="header-navigation-area d-none d-md-block">
              <ul class="main-menu nav position-relative" id="main-nav-menu">
                <li><a class="ml--2" href="/">Home</a></li>
                <!-- Main category links are injected by JS (up to 5 categories) -->
              </ul>
            </div>
          </div>
          <div class="col-8 col-sm-6 col-lg-2">
            <div class="header-action-area">
              <div class="header-action-search">
                <button class="btn-search btn-search-menu">
                  <i class="pe-7s-search"></i>
                </button>
              </div>
              <div class="header-action-login">
                <button class="btn-login" onclick="window.location.href='login-register'">
                  <i class="pe-7s-users"></i>
                </button>
              </div>
              <div class="header-action-wishlist">
                <button class="btn-wishlist" onclick="window.location.href='shop-wishlist'">
                  <span class="wishlist-count">0</span>
                  <i class="pe-7s-like"></i>
                </button>
              </div>
              <div class="header-action-cart">
                <button class="btn-cart cart-icon" onclick="window.location.href='shop-cart'">
                  <span class="cart-count">0</span>
                  <i class="pe-7s-shopbag"></i>
                </button>
              </div>
              <button class="btn-menu d-lg-none">
                <i class="ion-navicon"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--== End Header Wrapper ==-->
  
  <main class="main-content">
    <!--== Start Page Title Area ==-->
    <section class="page-title-area">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-12 m-auto">
            <div class="page-title-content text-center">
              <h2 class="title">Wishlist</h2>
              <!-- <div class="bread-crumbs"><a href="/"> Home </a><span class="breadcrumb-sep"> // </span><span class="active"> Wishlist</span></div> -->
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--== End Page Title Area ==-->

    <!--== Start Wishlist Area Wrapper ==-->
    <section class="product-area wishlist-page-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 m-auto">
            <div class="section-title text-center">
              <h2 class="title">Wishlist</h2>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <form action="#">
              <div class="wishlist-table-content">
                <div class="table-content table-responsive">
                  <table>
                    <thead>
                      <tr>
                        <th class="width-remove"></th>
                        <th class="width-name">Product</th>
                        <th class="width-price"> Unit price </th>
                        <th class="width-stock-status"> Stock status </th>
                        <th class="width-wishlist-cart"></th>
                      </tr>
                    </thead>
                    <tbody id="wishlist-items-container">
                      <!-- Wishlist items will be loaded dynamically here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
    <!--== End Wishlist Area Wrapper ==-->
  </main>

  <!--== Start Footer Area Wrapper ==-->
  <footer class="footer-area default-style" >
    <div class="footer-main">
      <div class="container">
        <div class="row">
          <div class="col-12 col-lg-4">
            <div class="widget-item item-style3">
              <div class="about-widget">
                <a class="footer-logo" href="/">
                  <img src="/assets/img/logo-light.png" alt="Logo">
                </a>
                <p>
                  Sensory a brand of ANKH Trading Pvt Ltd is a curated destination for premium sensory books, toddler sensory, and early learning products, created to support holistic childhood development. We bring together safe, reliable, and thoughtfully designed sensory essentials in one place—making it easier for parents, educators, and retailers to access quality products that encourage learning through play, exploration, and imagination.
0 
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-2">
            <div class="widget-item item-style1">
              <h4 class="widget-title">Quick Links</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-1">Quick Links</h4>
              <div id="dividerId-1" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap">
                  <ul class="nav-menu nav item-hover-style">
                    <li><a href="/">- Home</a></li>
                    <li><a href="about">- About</a></li>
                    <li><a href="shop">- Shop</a></li>
                    <li><a href="contact">- Contact</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="widget-item item-style2">
              <h4 class="widget-title">Company</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-3">Company</h4>
              <div id="dividerId-3" class="collapse widget-collapse-body">
                <nav class="widget-menu-wrap item-hover-style">
                  <ul class="nav-menu nav">
                    <li><a href="terms-and-conditions">- Terms & Conditions</a></li>
                    <li><a href="privacy-policy">- Privacy Policy</a></li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-3">
            <div class="widget-item">
              <h4 class="widget-title">Store Information.</h4>
              <h4 class="widget-title widget-collapsed-title collapsed" data-bs-toggle="collapse" data-bs-target="#dividerId-4">Store Information.</h4>
              <div id="dividerId-4" class="collapse widget-collapse-body">
                <p class="widget-address">296/A/1 , Level 2 <br>New Kandy Road, <br>Kothalawala, <br>Kaduwela,
                    <br>Sri Lanka</p>
                  <ul class="widget-contact-info">
                    <li>Phone: <a href="tel://+94761487787">+94761487787</a></li>
                    <li>Email: <a href="mailto:sensorysl12@gmail.com">sensorysl12@gmail.com</a></li>
                  </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <div class="footer-bottom-content">
          <div class="row text-center">
            <div class="col-sm-12">
              <div class="widget-copyright">
                <p><i class="fa fa-copyright"></i> 2025 <span>Sensory. </span> All Rights Reserved</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-shape bg-img" data-bg-img="/assets/img/photos/footer1.png"></div>
  </footer>
  <!--== End Footer Area Wrapper ==-->
  
  <!--== Scroll Top Button ==-->
  <div class="scroll-to-top"><span class="fa fa-angle-double-up"></span></div>

  <!--== Start Product Quick View ==-->
  <aside class="product-quick-view-modal">
    <div class="product-quick-view-inner">
      <div class="product-quick-view-content">
        <button type="button" class="btn-close">
          <span class="pe-7s-close"><i class="lastudioicon-e-remove"></i></span>
        </button>
        <div class="row row-gutter-0">
          <div class="col-lg-6 col-md-6 col-12">
            <div class="thumb">
              <img src="/assets/img/shop/quick-view1.jpg" alt="Image">
            </div>
          </div>
          <div class="col-lg-6 col-md-6 col-12">
            <div class="content" id="quick-view-content">
              <!-- Quick view content will be loaded dynamically -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="canvas-overlay"></div>
  </aside>
  <!--== End Product Quick View ==-->

  <!--== Start Aside Search Menu ==-->
  <div class="search-box-wrapper">
    <div class="search-box-content-inner">
      <div class="search-box-form-wrap">
        <div class="search-note">
          <p>Start typing and press Enter to search</p>
        </div>
        <form action="#" method="post">
          <div class="search-form position-relative">
            <label for="search-input" class="sr-only">Search</label>
            <input type="search" class="form-control" placeholder="Search" id="search-input">
            <button class="search-button"><i class="pe-7s-search"></i></button>
          </div>
        </form>
      </div>
    </div>
    <!--== End Aside Search Menu ==-->
    <a href="javascript:;" class="search-close"><i class="pe-7s-close"></i></a>
  </div>
  <!--== End Aside Search Menu ==-->

  <!--== Start Sidebar Cart Menu ==-->
  <aside class="sidebar-cart-modal">
    <div class="sidebar-cart-inner">
      <div class="sidebar-cart-content">
        <a class="cart-close" href="javascript:void(0);"><i class="pe-7s-close"></i></a>
        <div class="sidebar-cart-all">
          <div class="cart-header">
            <h3>Shopping Cart</h3>
            <div class="close-style-wrap">
              <span class="close-style close-style-width-1 cart-close"></span>
            </div>
          </div>
          <div class="cart-content cart-content-padding">
            <ul id="sidebar-cart-items">
              <!-- Cart items will be loaded dynamically here -->
            </ul>
            <div class="cart-total">
              <h4>Subtotal: <span id="sidebar-cart-subtotal">LKR 0.00</span></h4>
            </div>
            <div class="cart-checkout-btn">
              <a class="cart-btn" href="shop-cart">view cart</a>
              <a class="checkout-btn" href="shop-checkout">checkout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-cart-overlay"></div>
  <!--== End Sidebar Cart Menu ==-->

  <!--== Start Side Menu ==-->
  <aside class="off-canvas-wrapper">
    <div class="off-canvas-inner">
      <div class="off-canvas-overlay d-none"></div>
      <!-- Start Off Canvas Content Wrapper -->
      <div class="off-canvas-content">
        <!-- Off Canvas Header -->
        <div class="off-canvas-header">
          <div class="close-action">
            <button class="btn-close"><i class="pe-7s-close"></i></button>
          </div>
        </div>

        <div class="off-canvas-item">
          <!-- Start Mobile Menu Wrapper -->
          <div class="res-mobile-menu">
            <!-- Note Content Auto Generate By Jquery From Main Menu -->
          </div>
          <!-- End Mobile Menu Wrapper -->
        </div>
        <!-- Off Canvas Footer -->
        <div class="off-canvas-footer"></div>
      </div>
      <!-- End Off Canvas Content Wrapper -->
    </div>
  </aside>
  <!--== End Side Menu ==-->
</div>

<!--=======================Javascript============================-->

<!--=== Modernizr Min Js ===-->
<script src="/assets/js/modernizr.js"></script>
<!--=== jQuery Min Js ===-->
<script src="/assets/js/jquery-main.js"></script>
<!--=== jQuery Migration Min Js ===-->
<script src="/assets/js/jquery-migrate.js"></script>
<!--=== Popper Min Js ===-->
<script src="/assets/js/popper.min.js"></script>
<!--=== Bootstrap Min Js ===-->
<script src="/assets/js/bootstrap.min.js"></script>
<!--=== jquery Appear Js ===-->
<script src="/assets/js/jquery.appear.js"></script>
<!--=== jquery Swiper Min Js ===-->
<script src="/assets/js/swiper.min.js"></script>
<!--=== jquery Fancybox Min Js ===-->
<script src="/assets/js/fancybox.min.js"></script>
<!--=== jquery Aos Min Js ===-->
<script src="/assets/js/aos.min.js"></script>
<!--=== jquery Slicknav Js ===-->
<script src="/assets/js/jquery.slicknav.js"></script>
<!--=== jquery Countdown Js ===-->
<script src="/assets/js/jquery.countdown.min.js"></script>
<!--=== jquery Tippy Js ===-->
<script src="/assets/js/tippy.all.min.js"></script>
<!--=== Isotope Min Js ===-->
<script src="/assets/js/isotope.pkgd.min.js"></script>
<!--=== Parallax Min Js ===-->
<script src="/assets/js/parallax.min.js"></script>
<!--=== Slick  Min Js ===-->
<script src="/assets/js/slick.min.js"></script>
<!--=== jquery Wow Min Js ===-->
<script src="/assets/js/wow.min.js"></script>
<!--=== jquery Zoom Min Js ===-->
<script src="/assets/js/jquery-zoom.min.js"></script>

<!--=== API Config Js ===-->
<script src="/assets/js/config.js"></script>
<!--=== Cart & Wishlist Service Js ===-->
<script src="/assets/js/cart-service.js"></script>
<!--=== API Service Js ===-->
<script src="/assets/js/api-service.js"></script>
<!--=== Custom Js ===-->
<script src="/assets/js/custom.js"></script>
<!--=== Wishlist Page Js ===-->

<!-- Toast Notification Styles -->
<style>
  .toast-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 16px 24px;
    border-radius: 4px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 300px;
    animation: slideInRight 0.3s ease-out;
    font-size: 14px;
  }
  
  .toast-notification.success {
    background-color: #4CAF50;
  }
  
  .toast-notification.error {
    background-color: #f44336;
  }
  
  .toast-notification.info {
    background-color: #2196F3;
  }
  
  .toast-notification .toast-icon {
    font-size: 20px;
  }
  
  .toast-notification .toast-message {
    flex: 1;
  }
  
  .toast-notification .toast-close {
    cursor: pointer;
    font-size: 18px;
    opacity: 0.8;
    transition: opacity 0.2s;
  }
  
  .toast-notification .toast-close:hover {
    opacity: 1;
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
  
  .toast-notification.hide {
    animation: slideOutRight 0.3s ease-out forwards;
  }
  
  /* Product Quick View Modal - Centered and Scrollable */
  .product-quick-view-modal {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    overflow: hidden !important;
    padding: 20px !important;
  }
  
  .product-quick-view-modal.active {
    overflow: hidden !important;
  }
  
  .product-quick-view-inner {
    margin: 0 !important;
    max-height: 90vh !important;
    width: 100% !important;
    max-width: 1200px !important;
    display: flex !important;
    align-items: center !important;
    transform: translate(0, 0) !important;
  }
  
  .product-quick-view-content {
    max-height: 90vh !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
  }
  
  .product-quick-view-content .row {
    margin: 0 !important;
  }
  
  .product-quick-view-content .row > div {
    padding: 0 !important;
  }
  
  .product-quick-view-content .thumb {
    max-height: 90vh !important;
    overflow: hidden !important;
  }
  
  .product-quick-view-content .thumb img {
    object-fit: cover !important;
    height: 100% !important;
  }
  
  /* Prevent body scroll when modal is open */
  body.fix {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
  }
</style>

<script>
(function($) {
  'use strict';
  
  // Toast notification function
  function showToast(message, type = 'success') {
    // Remove existing toasts
    $('.toast-notification').remove();
    
    const icon = type === 'success' ? '<i class="ion-checkmark-circled"></i>' : 
                 type === 'error' ? '<i class="ion-close-circled"></i>' : 
                 '<i class="ion-information-circled"></i>';
    const toast = $(`
      <div class="toast-notification ${type}">
        <span class="toast-icon">${icon}</span>
        <span class="toast-message">${message}</span>
        <span class="toast-close">&times;</span>
      </div>
    `);
    
    $('body').append(toast);
    
    // Auto hide after 3 seconds
    setTimeout(function() {
      toast.addClass('hide');
      setTimeout(function() {
        toast.remove();
      }, 300);
    }, 3000);
    
    // Close on click
    toast.find('.toast-close').on('click', function() {
      toast.addClass('hide');
      setTimeout(function() {
        toast.remove();
      }, 300);
    });
  }
  
  // Format price with LKR currency
  function formatPrice(price) {
    if (price === null || price === undefined || price === 0) {
      return 'LKR 0.00';
    }
    return 'LKR ' + parseFloat(price).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
  
  // Render wishlist items
  async function renderWishlist() {
    const container = $('#wishlist-items-container');
    
    // Check if user is logged in
    if (typeof WishlistService === 'undefined' || !WishlistService.isLoggedIn()) {
      container.html('<tr><td colspan="5" class="text-center">Please <a href="login-register">login</a> to view your wishlist.</td></tr>');
      return;
    }
    
    try {
      // Show loading state
      container.html('<tr><td colspan="5" class="text-center">Loading wishlist...</td></tr>');
      
      const wishlist = await WishlistService.getWishlist();
      
      console.log('Wishlist items received:', wishlist);
      
      if (!wishlist || wishlist.length === 0) {
        container.html('<tr><td colspan="5" class="text-center">Your wishlist is empty. <a href="/">Continue Shopping</a></td></tr>');
        return;
      }
      
      container.empty();
      
      wishlist.forEach((item) => {
        // Handle different API response formats
        // The API returns items with: id (wishlist item ID), productId, productName, productPrice
        const itemId = item.id; // This is the wishlist item ID
        const productId = item.productId || item.id;
        const productName = item.productName || item.name || 'Product';
        const productPrice = item.productPrice || item.price || 0;
        // Try to get image from product data if available, otherwise use placeholder
        const imageURL = item.imageURL || item.imageUrl || item.productImageURL || 'https://www.holoimage.net/images/no-image.jpg';
        
        const productData = {
          id: productId,
          name: productName,
          imageURL: imageURL,
          sellingPrice: productPrice,
          unitPrice: productPrice
        };
        
        const rowHtml = `
          <tr data-product-id="${productId}" data-item-id="${itemId}">
            <td class="product-remove"><a href="javascript:void(0)" class="remove-wishlist-item" data-item-id="${itemId}" data-product-id="${productId}">×</a></td>
            <td class="product-name">
              <h5>
                <a href="shop-single-product.html?id=${productId}">${productName}</a>
                <a href="javascript:void(0)" class="wishlist-quick-view-btn" data-product-id="${productId}" style="margin-left: 10px; color: #f379a7; font-size: 14px;" title="View Details">
                  <i class="ion-arrow-expand"></i> View Details
                </a>
              </h5>
            </td>
            <td class="product-price"><span class="amount">${formatPrice(productPrice)}</span></td>
            <td class="stock-status">
              <span><i class="fa fa-check"></i> In Stock</span>
            </td>
            <td class="wishlist-cart"><a href="javascript:void(0)" class="add-wishlist-to-cart" data-product='${JSON.stringify(productData)}'>Add to Cart</a></td>
          </tr>
        `;
        
        container.append(rowHtml);
      });
    } catch (error) {
      console.error('Error loading wishlist:', error);
      container.html('<tr><td colspan="5" class="text-center">Error loading wishlist. Please try again later.</td></tr>');
    }
  }
  
  // Handle remove from wishlist
  $(document).on('click', '.remove-wishlist-item', async function() {
    const $this = $(this);
    const itemId = $this.data('item-id');
    const productId = $this.data('product-id');
    
    if (!itemId && !productId) {
      showToast('Unable to remove item. Please refresh the page and try again.', 'error');
      return;
    }
    
    // Disable button
    $this.prop('disabled', true).text('Removing...');
    
    try {
      let result;
      if (itemId) {
        // Remove by item ID (preferred)
        result = await WishlistService.removeFromWishlist(itemId);
      } else if (productId) {
        // Fallback to product ID
        result = await WishlistService.removeProductFromWishlist(productId);
      }
      
      if (result && result.success) {
        // Re-render wishlist
        await renderWishlist();
        // Update wishlist count
        if (typeof WishlistService !== 'undefined') {
          await WishlistService.updateWishlistCount();
        }
      } else {
        showToast(result ? result.message : 'Failed to remove item from wishlist', 'error');
      }
    } catch (error) {
      console.error('Error removing from wishlist:', error);
      showToast('An error occurred. Please try again.', 'error');
    } finally {
      $this.prop('disabled', false).text('×');
    }
  });
  
  // Handle add to cart from wishlist
  $(document).on('click', '.add-wishlist-to-cart', function() {
    let productData = $(this).data('product');
    
    // If data-product is a string, parse it
    if (typeof productData === 'string') {
      try {
        productData = JSON.parse(productData);
      } catch (e) {
        console.error('Error parsing product data:', e);
        return;
      }
    }
    
    if (productData && typeof CartService !== 'undefined') {
      CartService.addToCart(productData);
      showToast('Product added to cart!', 'success');
      CartService.updateCartCount();
    }
  });
  
  // Handle quick view from wishlist
  $(document).on('click', '.wishlist-quick-view-btn', async function(e) {
    e.preventDefault();
    const productId = $(this).data('product-id');
    
    if (!productId) {
      showToast('Product ID not found', 'error');
      return;
    }
    
    try {
      // Fetch product details
      if (typeof fetchProductById === 'function') {
        const product = await fetchProductById(productId);
        
        if (product) {
          showQuickViewModal(product);
        } else {
          showToast('Product not found', 'error');
        }
      } else {
        // Fallback: try to get product from wishlist item
        const $row = $(this).closest('tr');
        const productName = $row.find('.product-name h5 a').first().text();
        const productPrice = $row.find('.product-price .amount').text();
        
        // Try to extract price
        let price = 0;
        const priceMatch = productPrice.replace(/[^\d.]/g, '');
        if (priceMatch) {
          price = parseFloat(priceMatch) || 0;
        }
        
        const product = {
          id: productId,
          name: productName,
          imageURL: 'https://www.holoimage.net/images/no-image.jpg',
          sellingPrice: price,
          unitPrice: price,
          description: 'Product details not available. Please visit the product page for more information.'
        };
        
        showQuickViewModal(product);
      }
    } catch (error) {
      console.error('Error loading product details:', error);
      showToast('Error loading product details', 'error');
    }
  });
  
  // Function to show quick view modal
  function showQuickViewModal(product) {
    const productImage = product.imageURL || product.imageUrl || 'https://www.holoimage.net/images/no-image.jpg';
    const productName = product.name || 'Product Name';
    
    // Get price
    let productPrice = 0;
    if (product.sellingPrice !== null && product.sellingPrice !== undefined && product.sellingPrice > 0) {
      productPrice = product.sellingPrice;
    } else if (product.unitPrice !== null && product.unitPrice !== undefined && product.unitPrice > 0) {
      productPrice = product.unitPrice;
    }
    
    const productDescription = product.description || 'No description available.';
    const formattedPrice = formatPrice(productPrice);
    
    // Update modal image
    $('.product-quick-view-modal .thumb img').attr('src', productImage).attr('alt', productName);
    
    // Update modal content
    const modalContent = `
      <div class="single-product-info">
        <h4 class="title">${productName}</h4>
        <div class="prices">
          <span class="price">${formattedPrice}</span>
        </div>
        <div class="product-rating">
          <div class="rating">
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
            <span class="fa fa-star"></span>
          </div>
        </div>
        <p class="product-desc">${productDescription}</p>
        <div class="quick-product-action">
          <div class="action-top">
            <div class="pro-qty">
              <input type="text" id="modal-quantity" title="Quantity" value="1" min="1" />
            </div>
            <button class="btn btn-theme add-to-cart-btn" data-product='${JSON.stringify(product)}'>Add to Cart</button>
            <a class="btn-wishlist add-to-wishlist-btn" href="javascript:void(0)" data-product='${JSON.stringify(product)}">Add to Wishlist</a>
          </div>
        </div>
        <div class="widget">
          <h3 class="title">Product ID:</h3>
          <div class="widget-tags">
            <span>${product.id}</span>
          </div>
        </div>
      </div>
    `;
    
    $('#quick-view-content').html(modalContent);
    
    // Initialize quantity buttons
    const modalProQty = $('#quick-view-content .pro-qty');
    if (modalProQty.length > 0 && modalProQty.find('.qty-btn').length === 0) {
      modalProQty.append('<a href="#" class="inc qty-btn"><i class="fa fa-plus"></i></a>');
      modalProQty.append('<a href="#" class="dec qty-btn"><i class="fa fa-minus"></i></a>');
    }
    
    // Show modal
    $('.product-quick-view-modal').addClass('active');
    $('body').addClass('fix');
  }
  
  // Handle modal close
  $(document).on('click', '.product-quick-view-modal .btn-close, .canvas-overlay', function() {
    $('.product-quick-view-modal').removeClass('active');
    $('body').removeClass('fix');
  });
  
  // Handle add to cart from modal
  $(document).on('click', '.product-quick-view-modal .add-to-cart-btn', function(e) {
    e.preventDefault();
    const productData = JSON.parse($(this).attr('data-product'));
    
    // Get quantity from modal input
    const quantityInput = $('.product-quick-view-modal #modal-quantity');
    if (quantityInput.length > 0) {
      const quantity = parseInt(quantityInput.val()) || 1;
      if (quantity > 0) {
        productData.quantity = quantity;
      }
    }
    
    if (window.CartService) {
      window.CartService.addToCart(productData);
      showToast('Product added to cart!', 'success');
      window.CartService.updateCartCount();
    }
  });
  
  // Handle add to wishlist from modal
  $(document).on('click', '.product-quick-view-modal .add-to-wishlist-btn', async function(e) {
    e.preventDefault();
    const $this = $(this);
    let productData;
    
    try {
      const productDataStr = $this.attr('data-product');
      if (!productDataStr) {
        console.error('No product data found');
        return;
      }
      productData = JSON.parse(productDataStr);
    } catch (error) {
      console.error('Error parsing product data:', error);
      return;
    }
    
    if (productData && typeof window.WishlistService !== 'undefined') {
      $this.prop('disabled', true);
      
      try {
        const result = await window.WishlistService.addToWishlist(productData);
        
        if (result.success) {
          showToast(result.message || 'Product added to wishlist!', 'success');
          // Refresh wishlist
          await renderWishlist();
          await window.WishlistService.updateWishlistCount();
        } else {
          showToast(result.message || 'Failed to add product to wishlist', 'error');
        }
      } catch (error) {
        console.error('Error adding to wishlist:', error);
        showToast('An error occurred. Please try again.', 'error');
      } finally {
        $this.prop('disabled', false);
      }
    }
  });
  
  // Handle quantity buttons in modal
  $(document).on('click', '.product-quick-view-modal .qty-btn', function(e) {
    e.preventDefault();
    const $button = $(this);
    const $input = $button.parent().find('input');
    const oldValue = parseInt($input.val()) || 1;
    
    if ($button.hasClass('inc')) {
      const newVal = oldValue + 1;
      $input.val(newVal);
    } else if ($button.hasClass('dec')) {
      if (oldValue > 1) {
        const newVal = oldValue - 1;
        $input.val(newVal);
      } else {
        $input.val(1);
      }
    }
  });
  
  // Initialize wishlist on page load
  $(document).ready(async function() {
    await renderWishlist();
    if (typeof WishlistService !== 'undefined') {
      await WishlistService.updateWishlistCount();
    }
    if (typeof CartService !== 'undefined') {
      CartService.updateCartCount();
    }
  });
  
})(jQuery);
</script>

</body>

</html>